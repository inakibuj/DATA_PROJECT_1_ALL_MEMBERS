[0m21:24:28.590999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753074de6c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753074de7c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753074c3df50>]}


============================== 21:24:28.634819 | db134723-3a05-492f-9847-74e4a6c22cb7 ==============================
[0m21:24:28.634819 [info ] [MainThread]: Running with dbt=1.6.0
[0m21:24:28.650545 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m21:24:29.849018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'db134723-3a05-492f-9847-74e4a6c22cb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753074cf6a50>]}
[0m21:24:29.872878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'db134723-3a05-492f-9847-74e4a6c22cb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753074d04650>]}
[0m21:24:29.876484 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m21:24:29.908209 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m21:24:29.922671 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m21:24:29.928774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'db134723-3a05-492f-9847-74e4a6c22cb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753074c3d090>]}
[0m21:24:31.513288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'db134723-3a05-492f-9847-74e4a6c22cb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753072be6510>]}
[0m21:24:31.564497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'db134723-3a05-492f-9847-74e4a6c22cb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753072c44b10>]}
[0m21:24:31.567621 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m21:24:31.573479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db134723-3a05-492f-9847-74e4a6c22cb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753073547350>]}
[0m21:24:31.578202 [info ] [MainThread]: 
[0m21:24:31.590415 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m21:24:31.595607 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m21:24:31.621801 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m21:24:31.626117 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m21:24:31.627959 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:24:31.667127 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m21:24:31.670480 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m21:24:31.675444 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m21:24:31.689664 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m21:24:31.691641 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m21:24:31.693514 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:24:31.703164 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m21:24:31.709547 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m21:24:31.714736 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m21:24:31.730168 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m21:24:31.733792 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m21:24:31.736072 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m21:24:31.746964 [debug] [MainThread]: Using postgres connection "master"
[0m21:24:31.748698 [debug] [MainThread]: On master: BEGIN
[0m21:24:31.750589 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:24:31.760229 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:24:31.762199 [debug] [MainThread]: Using postgres connection "master"
[0m21:24:31.764050 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m21:24:31.779187 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m21:24:31.782997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db134723-3a05-492f-9847-74e4a6c22cb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753072be1a90>]}
[0m21:24:31.785477 [debug] [MainThread]: On master: ROLLBACK
[0m21:24:31.787879 [debug] [MainThread]: Using postgres connection "master"
[0m21:24:31.790133 [debug] [MainThread]: On master: BEGIN
[0m21:24:31.792970 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:24:31.795042 [debug] [MainThread]: On master: COMMIT
[0m21:24:31.797154 [debug] [MainThread]: Using postgres connection "master"
[0m21:24:31.799237 [debug] [MainThread]: On master: COMMIT
[0m21:24:31.801562 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m21:24:31.803797 [debug] [MainThread]: On master: Close
[0m21:24:31.807187 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:24:31.810402 [info ] [MainThread]: 
[0m21:24:31.833929 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m21:24:31.839064 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m21:24:31.848347 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m21:24:31.850912 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m21:24:31.869220 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m21:24:31.898351 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 21:24:31.852579 => 21:24:31.897771
[0m21:24:31.900564 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m21:24:31.971492 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m21:24:31.995350 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m21:24:31.997391 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m21:24:31.999425 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:24:32.010255 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m21:24:32.012520 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m21:24:32.015196 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- Convertimos el texto del JSON a Entero
    CAST(data->>'aqi' AS INTEGER) as indice_aqi,
    
    -- Sacamos el nombre de la estaciÃ³n (estÃ¡ anidado dentro de 'station')
    data->'station'->>'name' as nombre_estacion,
    
    -- Convertimos la fecha de texto a formato Fecha real
    CAST(data->'time'->>'s' AS TIMESTAMP) as fecha_medicion,
    
    -- Mantenemos nuestra fecha de cuando guardamos el dato
    ingestion_time

FROM raw_pollution
WHERE data->>'aqi' IS NOT NULL -- Filtramos si viene alguno vacÃ­o
  );
  
[0m21:24:32.031603 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.0 seconds
[0m21:24:32.044105 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m21:24:32.046257 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m21:24:32.049206 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:24:32.080565 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m21:24:32.083838 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m21:24:32.086726 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m21:24:32.093472 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m21:24:32.115275 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m21:24:32.117994 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m21:24:32.121246 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m21:24:32.128880 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 21:24:31.902445 => 21:24:32.127402
[0m21:24:32.132009 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m21:24:32.135342 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db134723-3a05-492f-9847-74e4a6c22cb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753072bfaa90>]}
[0m21:24:32.140489 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 0[0m in 0.29s]
[0m21:24:32.144297 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m21:24:32.156400 [debug] [MainThread]: Using postgres connection "master"
[0m21:24:32.159657 [debug] [MainThread]: On master: BEGIN
[0m21:24:32.162194 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:24:32.179600 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:24:32.181759 [debug] [MainThread]: On master: COMMIT
[0m21:24:32.183942 [debug] [MainThread]: Using postgres connection "master"
[0m21:24:32.186178 [debug] [MainThread]: On master: COMMIT
[0m21:24:32.188507 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m21:24:32.192152 [debug] [MainThread]: On master: Close
[0m21:24:32.195655 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:24:32.197472 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m21:24:32.199715 [info ] [MainThread]: 
[0m21:24:32.202935 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.62 seconds (0.62s).
[0m21:24:32.206939 [debug] [MainThread]: Command end result
[0m21:24:32.258468 [info ] [MainThread]: 
[0m21:24:32.261944 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:24:32.265761 [info ] [MainThread]: 
[0m21:24:32.271275 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:24:32.276297 [debug] [MainThread]: Command `dbt run` succeeded at 21:24:32.275831 after 4.03 seconds
[0m21:24:32.282143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753078e90350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75307354c050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753078dc6e90>]}
[0m21:24:32.284664 [debug] [MainThread]: Flushing usage events
[0m21:44:13.087543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7914144dfd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7914159d2950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79141467a590>]}


============================== 21:44:13.191039 | b2d141ef-0c6a-47c0-bb90-429a28a5d79d ==============================
[0m21:44:13.191039 [info ] [MainThread]: Running with dbt=1.6.0
[0m21:44:13.201185 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:44:14.498783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b2d141ef-0c6a-47c0-bb90-429a28a5d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x791414505190>]}
[0m21:44:14.516890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b2d141ef-0c6a-47c0-bb90-429a28a5d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x791414582cd0>]}
[0m21:44:14.521389 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m21:44:14.555848 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m21:44:14.725487 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:44:14.730161 [debug] [MainThread]: Partial parsing: updated file: calidad_aire_valencia://models/clean_pollution.sql
[0m21:44:14.836419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b2d141ef-0c6a-47c0-bb90-429a28a5d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x791412dbf850>]}
[0m21:44:14.910165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b2d141ef-0c6a-47c0-bb90-429a28a5d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x791412d61f90>]}
[0m21:44:14.914001 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m21:44:14.925059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b2d141ef-0c6a-47c0-bb90-429a28a5d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79141467a710>]}
[0m21:44:14.930631 [info ] [MainThread]: 
[0m21:44:14.937160 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m21:44:14.946141 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m21:44:14.978708 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m21:44:14.981181 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m21:44:14.982536 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:44:15.058871 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m21:44:15.062711 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m21:44:15.067273 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m21:44:15.077893 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m21:44:15.080099 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m21:44:15.081850 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:44:15.096067 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m21:44:15.098726 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m21:44:15.100354 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m21:44:15.121639 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m21:44:15.124154 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m21:44:15.127278 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m21:44:15.138027 [debug] [MainThread]: Using postgres connection "master"
[0m21:44:15.139899 [debug] [MainThread]: On master: BEGIN
[0m21:44:15.142240 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:44:15.157171 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:44:15.158892 [debug] [MainThread]: Using postgres connection "master"
[0m21:44:15.160737 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m21:44:15.210146 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m21:44:15.213499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b2d141ef-0c6a-47c0-bb90-429a28a5d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7914145875d0>]}
[0m21:44:15.215612 [debug] [MainThread]: On master: ROLLBACK
[0m21:44:15.217687 [debug] [MainThread]: Using postgres connection "master"
[0m21:44:15.219533 [debug] [MainThread]: On master: BEGIN
[0m21:44:15.221969 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:44:15.223816 [debug] [MainThread]: On master: COMMIT
[0m21:44:15.225610 [debug] [MainThread]: Using postgres connection "master"
[0m21:44:15.227670 [debug] [MainThread]: On master: COMMIT
[0m21:44:15.229896 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m21:44:15.231785 [debug] [MainThread]: On master: Close
[0m21:44:15.237372 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:44:15.241437 [info ] [MainThread]: 
[0m21:44:15.261571 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m21:44:15.265440 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m21:44:15.269470 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m21:44:15.272968 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m21:44:15.290808 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m21:44:15.309615 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 21:44:15.274638 => 21:44:15.308848
[0m21:44:15.313060 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m21:44:15.403996 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m21:44:15.419711 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m21:44:15.422032 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m21:44:15.424113 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:44:15.435892 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m21:44:15.438392 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m21:44:15.440743 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- TRUCO: Como tu dashboard busca una columna 'indice_aqi',
    -- vamos a pasarle el valor del NO2 (que sÃ­ tienes, es el 86.0 de tu foto).
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- Intentamos sacar el nombre. Si no viene en el JSON, inventamos uno con el ID.
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- Mantenemos la fecha de ingestiÃ³n
    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL -- Solo cogemos registros que tengan dato de NO2
  );
  
[0m21:44:15.477730 [debug] [Thread-1 (]: SQL status: SELECT 11 in 0.0 seconds
[0m21:44:15.489435 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m21:44:15.498755 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution" rename to "clean_pollution__dbt_backup"
[0m21:44:15.502542 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:44:15.507445 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m21:44:15.509166 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m21:44:15.511281 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m21:44:15.556469 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m21:44:15.590800 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m21:44:15.617015 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m21:44:15.660493 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m21:44:15.748695 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m21:44:15.760759 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m21:44:15.912364 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m21:44:15.947562 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 21:44:15.315373 => 21:44:15.947037
[0m21:44:15.967927 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m21:44:15.978595 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2d141ef-0c6a-47c0-bb90-429a28a5d79d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x791414585d50>]}
[0m21:44:15.998754 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 11[0m in 0.71s]
[0m21:44:16.021832 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m21:44:16.059036 [debug] [MainThread]: Using postgres connection "master"
[0m21:44:16.079470 [debug] [MainThread]: On master: BEGIN
[0m21:44:16.087957 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:44:16.102335 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m21:44:16.104285 [debug] [MainThread]: On master: COMMIT
[0m21:44:16.108758 [debug] [MainThread]: Using postgres connection "master"
[0m21:44:16.111024 [debug] [MainThread]: On master: COMMIT
[0m21:44:16.113698 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m21:44:16.115662 [debug] [MainThread]: On master: Close
[0m21:44:16.118671 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:44:16.121215 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m21:44:16.124478 [info ] [MainThread]: 
[0m21:44:16.130545 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.19 seconds (1.19s).
[0m21:44:16.135440 [debug] [MainThread]: Command end result
[0m21:44:16.189566 [info ] [MainThread]: 
[0m21:44:16.192328 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:44:16.197204 [info ] [MainThread]: 
[0m21:44:16.204624 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:44:16.208667 [debug] [MainThread]: Command `dbt run` succeeded at 21:44:16.208251 after 3.17 seconds
[0m21:44:16.213523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7914187abfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7914187b0d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7914187b0f10>]}
[0m21:44:16.216092 [debug] [MainThread]: Flushing usage events
[0m22:28:05.343103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75b4063bc750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75b4078ce950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75b406b1a110>]}


============================== 22:28:05.358667 | f66094b6-6a9e-47f4-abf5-d2a1a7a5fd86 ==============================
[0m22:28:05.358667 [info ] [MainThread]: Running with dbt=1.6.0
[0m22:28:05.364897 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:28:05.656652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f66094b6-6a9e-47f4-abf5-d2a1a7a5fd86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75b406470650>]}
[0m22:28:05.669739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f66094b6-6a9e-47f4-abf5-d2a1a7a5fd86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75b40646ec50>]}
[0m22:28:05.672746 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m22:28:05.713243 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m22:28:05.868556 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:28:05.870714 [debug] [MainThread]: Partial parsing: updated file: calidad_aire_valencia://models/clean_pollution.sql
[0m22:28:05.979989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f66094b6-6a9e-47f4-abf5-d2a1a7a5fd86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75b404c7f6d0>]}
[0m22:28:06.033121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f66094b6-6a9e-47f4-abf5-d2a1a7a5fd86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75b404b98f90>]}
[0m22:28:06.036331 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m22:28:06.040994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f66094b6-6a9e-47f4-abf5-d2a1a7a5fd86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75b409718050>]}
[0m22:28:06.050235 [info ] [MainThread]: 
[0m22:28:06.057116 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:28:06.061932 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m22:28:06.129655 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m22:28:06.164584 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m22:28:06.179961 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:28:06.454640 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m22:28:06.497797 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m22:28:06.551134 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m22:28:06.621187 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m22:28:06.642212 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m22:28:06.732844 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:28:06.829888 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m22:28:06.909062 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m22:28:06.960288 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m22:28:07.063389 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m22:28:07.112855 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m22:28:07.148288 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m22:28:07.226247 [debug] [MainThread]: Using postgres connection "master"
[0m22:28:07.257670 [debug] [MainThread]: On master: BEGIN
[0m22:28:07.278055 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:28:07.310826 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m22:28:07.392312 [debug] [MainThread]: Using postgres connection "master"
[0m22:28:07.471258 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m22:28:07.633154 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m22:28:07.652679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f66094b6-6a9e-47f4-abf5-d2a1a7a5fd86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75b4063bd490>]}
[0m22:28:07.676409 [debug] [MainThread]: On master: ROLLBACK
[0m22:28:07.693073 [debug] [MainThread]: Using postgres connection "master"
[0m22:28:07.699997 [debug] [MainThread]: On master: BEGIN
[0m22:28:07.710227 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m22:28:07.713384 [debug] [MainThread]: On master: COMMIT
[0m22:28:07.716935 [debug] [MainThread]: Using postgres connection "master"
[0m22:28:07.721828 [debug] [MainThread]: On master: COMMIT
[0m22:28:07.727963 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m22:28:07.731769 [debug] [MainThread]: On master: Close
[0m22:28:07.737861 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:28:07.743089 [info ] [MainThread]: 
[0m22:28:07.813857 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m22:28:07.820090 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m22:28:07.831554 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m22:28:07.843215 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m22:28:07.886596 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m22:28:07.927110 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 22:28:07.847132 => 22:28:07.926405
[0m22:28:07.932287 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m22:28:08.136481 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m22:28:08.178916 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m22:28:08.192767 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m22:28:08.196431 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:28:08.214288 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m22:28:08.220490 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m22:28:08.223076 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m22:28:08.301273 [debug] [Thread-1 (]: SQL status: SELECT 44 in 0.0 seconds
[0m22:28:08.325157 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m22:28:08.331890 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution" rename to "clean_pollution__dbt_backup"
[0m22:28:08.336989 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m22:28:08.379212 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m22:28:08.393997 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m22:28:08.400563 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m22:28:08.520537 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m22:28:08.523543 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m22:28:08.525945 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m22:28:08.530643 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m22:28:08.550157 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m22:28:08.553048 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m22:28:08.572239 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m22:28:08.577001 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 22:28:07.939674 => 22:28:08.576520
[0m22:28:08.579166 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m22:28:08.582517 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f66094b6-6a9e-47f4-abf5-d2a1a7a5fd86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75b404b99650>]}
[0m22:28:08.586975 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 44[0m in 0.75s]
[0m22:28:08.591518 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m22:28:08.608824 [debug] [MainThread]: Using postgres connection "master"
[0m22:28:08.612110 [debug] [MainThread]: On master: BEGIN
[0m22:28:08.614932 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:28:08.635103 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m22:28:08.640787 [debug] [MainThread]: On master: COMMIT
[0m22:28:08.642866 [debug] [MainThread]: Using postgres connection "master"
[0m22:28:08.645090 [debug] [MainThread]: On master: COMMIT
[0m22:28:08.647352 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m22:28:08.649527 [debug] [MainThread]: On master: Close
[0m22:28:08.658239 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:28:08.661595 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m22:28:08.664413 [info ] [MainThread]: 
[0m22:28:08.668446 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.61 seconds (2.61s).
[0m22:28:08.672082 [debug] [MainThread]: Command end result
[0m22:28:08.721415 [info ] [MainThread]: 
[0m22:28:08.730499 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:28:08.745081 [info ] [MainThread]: 
[0m22:28:08.749128 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:28:08.753836 [debug] [MainThread]: Command `dbt run` succeeded at 22:28:08.753381 after 3.45 seconds
[0m22:28:08.758591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75b40a697fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75b40a5403d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75b40a540350>]}
[0m22:28:08.761069 [debug] [MainThread]: Flushing usage events
[0m11:04:08.670627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x731f35191610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x731f35191650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x731f35192550>]}


============================== 11:04:08.676309 | 0660b243-2885-44c0-98fd-2dca1181d5d8 ==============================
[0m11:04:08.676309 [info ] [MainThread]: Running with dbt=1.6.0
[0m11:04:08.677580 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt debug', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:04:08.679651 [info ] [MainThread]: dbt version: 1.6.0
[0m11:04:08.681002 [info ] [MainThread]: python version: 3.11.2
[0m11:04:08.681990 [info ] [MainThread]: python path: /usr/local/bin/python
[0m11:04:08.682977 [info ] [MainThread]: os info: Linux-6.6.87.2-microsoft-standard-WSL2-x86_64-with-glibc2.31
[0m11:04:08.764674 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m11:04:08.766475 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m11:04:08.767861 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m11:04:08.769292 [info ] [MainThread]: adapter type: postgres
[0m11:04:08.770378 [info ] [MainThread]: adapter version: 1.6.0
[0m11:04:08.788462 [info ] [MainThread]: Configuration:
[0m11:04:08.789876 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m11:04:08.791185 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m11:04:08.792359 [info ] [MainThread]: Required dependencies:
[0m11:04:08.793182 [debug] [MainThread]: Executing "git --help"
[0m11:04:08.795778 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m11:04:08.797199 [debug] [MainThread]: STDERR: "b''"
[0m11:04:08.798334 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m11:04:08.799549 [info ] [MainThread]: Connection:
[0m11:04:08.800251 [info ] [MainThread]:   host: postgres_dp1
[0m11:04:08.801560 [info ] [MainThread]:   port: 5432
[0m11:04:08.802579 [info ] [MainThread]:   user: admin
[0m11:04:08.803617 [info ] [MainThread]:   database: calidad_aire
[0m11:04:08.804493 [info ] [MainThread]:   schema: public
[0m11:04:08.805680 [info ] [MainThread]:   connect_timeout: 10
[0m11:04:08.806532 [info ] [MainThread]:   role: None
[0m11:04:08.807747 [info ] [MainThread]:   search_path: None
[0m11:04:08.808963 [info ] [MainThread]:   keepalives_idle: 0
[0m11:04:08.810036 [info ] [MainThread]:   sslmode: None
[0m11:04:08.811322 [info ] [MainThread]:   sslcert: None
[0m11:04:08.812438 [info ] [MainThread]:   sslkey: None
[0m11:04:08.813698 [info ] [MainThread]:   sslrootcert: None
[0m11:04:08.814490 [info ] [MainThread]:   application_name: dbt
[0m11:04:08.815531 [info ] [MainThread]:   retries: 1
[0m11:04:08.817485 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m11:04:08.818702 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m11:04:08.820062 [debug] [MainThread]: Using postgres connection "debug"
[0m11:04:08.823940 [debug] [MainThread]: On debug: select 1 as id
[0m11:04:08.828398 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:04:08.835975 [debug] [MainThread]: SQL status: SELECT 1 in 0.0 seconds
[0m11:04:08.838116 [debug] [MainThread]: On debug: Close
[0m11:04:08.839318 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m11:04:08.840432 [info ] [MainThread]: [32mAll checks passed![0m
[0m11:04:08.842363 [debug] [MainThread]: Command `dbt debug` succeeded at 11:04:08.842193 after 0.22 seconds
[0m11:04:08.843876 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m11:04:08.845451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x731f36c2afd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x731f3931c610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x731f3931e310>]}
[0m11:04:08.846590 [debug] [MainThread]: Flushing usage events
[0m11:04:17.033398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c23670e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c23662f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c23fe20d0>]}


============================== 11:04:17.036332 | 491cc3c0-b668-4890-900f-91224a68dc61 ==============================
[0m11:04:17.036332 [info ] [MainThread]: Running with dbt=1.6.0
[0m11:04:17.037460 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:04:17.212638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '491cc3c0-b668-4890-900f-91224a68dc61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c2349cb90>]}
[0m11:04:17.221659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '491cc3c0-b668-4890-900f-91224a68dc61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c2353fc50>]}
[0m11:04:17.226755 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m11:04:17.234759 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m11:04:17.327664 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:04:17.330885 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:04:17.342641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '491cc3c0-b668-4890-900f-91224a68dc61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c23539d10>]}
[0m11:04:17.401670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '491cc3c0-b668-4890-900f-91224a68dc61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c21d48ad0>]}
[0m11:04:17.404112 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m11:04:17.406314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '491cc3c0-b668-4890-900f-91224a68dc61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c236601d0>]}
[0m11:04:17.409225 [info ] [MainThread]: 
[0m11:04:17.411259 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:04:17.413726 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m11:04:17.430264 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m11:04:17.432087 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m11:04:17.433244 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:04:17.438266 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m11:04:17.440483 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m11:04:17.442779 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m11:04:17.449982 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m11:04:17.451672 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m11:04:17.453090 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:04:17.457200 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m11:04:17.458596 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m11:04:17.459790 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m11:04:17.462978 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m11:04:17.464884 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m11:04:17.466070 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m11:04:17.470446 [debug] [MainThread]: Using postgres connection "master"
[0m11:04:17.471534 [debug] [MainThread]: On master: BEGIN
[0m11:04:17.472545 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:04:17.476176 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:04:17.477519 [debug] [MainThread]: Using postgres connection "master"
[0m11:04:17.478995 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:04:17.484237 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m11:04:17.485995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '491cc3c0-b668-4890-900f-91224a68dc61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c24329e10>]}
[0m11:04:17.487282 [debug] [MainThread]: On master: ROLLBACK
[0m11:04:17.488499 [debug] [MainThread]: Using postgres connection "master"
[0m11:04:17.489470 [debug] [MainThread]: On master: BEGIN
[0m11:04:17.490644 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:04:17.492644 [debug] [MainThread]: On master: COMMIT
[0m11:04:17.494559 [debug] [MainThread]: Using postgres connection "master"
[0m11:04:17.497135 [debug] [MainThread]: On master: COMMIT
[0m11:04:17.499796 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m11:04:17.503281 [debug] [MainThread]: On master: Close
[0m11:04:17.506748 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:04:17.510291 [info ] [MainThread]: 
[0m11:04:17.518765 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m11:04:17.522284 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m11:04:17.525911 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m11:04:17.531412 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m11:04:17.538383 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m11:04:17.766779 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 11:04:17.533567 => 11:04:17.764163
[0m11:04:17.813399 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m11:04:17.870551 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m11:04:18.151301 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:04:18.187498 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m11:04:18.215603 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:04:18.253789 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m11:04:18.273108 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:04:18.300352 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m11:04:18.348115 [debug] [Thread-1 (]: SQL status: SELECT 22 in 0.0 seconds
[0m11:04:18.401253 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:04:18.427238 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m11:04:18.458425 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m11:04:18.510444 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m11:04:18.542305 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:04:18.562579 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m11:04:18.593029 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m11:04:18.632347 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:04:18.662021 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m11:04:18.680231 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m11:04:18.709699 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 11:04:17.838109 => 11:04:18.709562
[0m11:04:18.757446 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m11:04:18.787606 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '491cc3c0-b668-4890-900f-91224a68dc61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c21dcf810>]}
[0m11:04:18.818124 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 22[0m in 1.26s]
[0m11:04:18.844672 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m11:04:18.998699 [debug] [MainThread]: Using postgres connection "master"
[0m11:04:19.025321 [debug] [MainThread]: On master: BEGIN
[0m11:04:19.061890 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:04:19.109366 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:04:19.139636 [debug] [MainThread]: On master: COMMIT
[0m11:04:19.166227 [debug] [MainThread]: Using postgres connection "master"
[0m11:04:19.196933 [debug] [MainThread]: On master: COMMIT
[0m11:04:19.231138 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m11:04:19.270753 [debug] [MainThread]: On master: Close
[0m11:04:19.306999 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:04:19.330618 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m11:04:19.355832 [info ] [MainThread]: 
[0m11:04:19.387793 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.94 seconds (1.94s).
[0m11:04:19.420435 [debug] [MainThread]: Command end result
[0m11:04:19.958995 [info ] [MainThread]: 
[0m11:04:19.987441 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:04:20.012390 [info ] [MainThread]: 
[0m11:04:20.037307 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:04:20.057557 [debug] [MainThread]: Command `dbt run` succeeded at 11:04:20.057233 after 3.04 seconds
[0m11:04:20.074869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c27628590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c27784150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4c27785050>]}
[0m11:04:20.093457 [debug] [MainThread]: Flushing usage events
[0m11:18:10.774230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b774a9b5fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b774af620d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b774a9b6250>]}


============================== 11:18:10.802051 | 11bc507f-21e5-483f-a374-08f6de7cd4f3 ==============================
[0m11:18:10.802051 [info ] [MainThread]: Running with dbt=1.6.0
[0m11:18:10.829748 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:18:11.044389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '11bc507f-21e5-483f-a374-08f6de7cd4f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b774a9b4a90>]}
[0m11:18:11.121866 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m11:18:11.144335 [debug] [MainThread]: Command `dbt deps` succeeded at 11:18:11.143948 after 0.82 seconds
[0m11:18:11.163848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b774a9bb990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b774e9745d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b774e974550>]}
[0m11:18:11.188488 [debug] [MainThread]: Flushing usage events
[0m11:18:13.345527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d942d7ccd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d942d72d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d942d6ef10>]}


============================== 11:18:13.348725 | c3f2a35e-9ea7-448d-be7e-f5bcda9dd40b ==============================
[0m11:18:13.348725 [info ] [MainThread]: Running with dbt=1.6.0
[0m11:18:13.352889 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m11:18:13.472445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c3f2a35e-9ea7-448d-be7e-f5bcda9dd40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d942d6ea50>]}
[0m11:18:13.478247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c3f2a35e-9ea7-448d-be7e-f5bcda9dd40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d942da09d0>]}
[0m11:18:13.480121 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m11:18:13.496517 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m11:18:13.558521 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:18:13.560590 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:18:13.566070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c3f2a35e-9ea7-448d-be7e-f5bcda9dd40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d942d73210>]}
[0m11:18:13.642441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c3f2a35e-9ea7-448d-be7e-f5bcda9dd40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d941648510>]}
[0m11:18:13.643627 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m11:18:13.644769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c3f2a35e-9ea7-448d-be7e-f5bcda9dd40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d9442f2890>]}
[0m11:18:13.646372 [info ] [MainThread]: 
[0m11:18:13.647439 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:18:13.649151 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m11:18:13.656292 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m11:18:13.657519 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m11:18:13.658506 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:18:13.663511 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m11:18:13.666129 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m11:18:13.668093 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m11:18:13.672730 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m11:18:13.674014 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m11:18:13.675303 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:18:13.679348 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m11:18:13.681137 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m11:18:13.687314 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m11:18:13.692786 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m11:18:13.696568 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m11:18:13.699912 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m11:18:13.706490 [debug] [MainThread]: Using postgres connection "master"
[0m11:18:13.711228 [debug] [MainThread]: On master: BEGIN
[0m11:18:13.713753 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:18:13.724437 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:18:13.729285 [debug] [MainThread]: Using postgres connection "master"
[0m11:18:13.732725 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:18:13.743627 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m11:18:13.748620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c3f2a35e-9ea7-448d-be7e-f5bcda9dd40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d94391f050>]}
[0m11:18:13.756390 [debug] [MainThread]: On master: ROLLBACK
[0m11:18:13.758518 [debug] [MainThread]: Using postgres connection "master"
[0m11:18:13.763731 [debug] [MainThread]: On master: BEGIN
[0m11:18:13.766175 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:18:13.771353 [debug] [MainThread]: On master: COMMIT
[0m11:18:13.773411 [debug] [MainThread]: Using postgres connection "master"
[0m11:18:13.779088 [debug] [MainThread]: On master: COMMIT
[0m11:18:13.781503 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m11:18:13.788017 [debug] [MainThread]: On master: Close
[0m11:18:13.790705 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:18:13.792792 [info ] [MainThread]: 
[0m11:18:13.798654 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m11:18:13.799725 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m11:18:13.800646 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m11:18:13.801435 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m11:18:13.806093 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m11:18:13.812463 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 11:18:13.802196 => 11:18:13.812256
[0m11:18:13.813401 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m11:18:13.835971 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m11:18:13.859039 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:18:13.861731 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m11:18:13.865646 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:18:13.871215 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m11:18:13.877313 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:18:13.879767 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m11:18:13.887545 [debug] [Thread-1 (]: SQL status: SELECT 11 in 0.0 seconds
[0m11:18:13.894163 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:18:13.896145 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m11:18:13.899078 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m11:18:13.911889 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m11:18:13.918393 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:18:13.920328 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m11:18:13.924481 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m11:18:13.930748 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:18:13.932827 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m11:18:13.934642 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m11:18:13.936932 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 11:18:13.814204 => 11:18:13.936800
[0m11:18:13.938387 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m11:18:13.940070 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3f2a35e-9ea7-448d-be7e-f5bcda9dd40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d9415f1410>]}
[0m11:18:13.941423 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 11[0m in 0.14s]
[0m11:18:13.942725 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m11:18:13.956681 [debug] [MainThread]: Using postgres connection "master"
[0m11:18:13.958339 [debug] [MainThread]: On master: BEGIN
[0m11:18:13.959446 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:18:13.963326 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:18:13.966717 [debug] [MainThread]: On master: COMMIT
[0m11:18:13.969239 [debug] [MainThread]: Using postgres connection "master"
[0m11:18:13.970468 [debug] [MainThread]: On master: COMMIT
[0m11:18:13.971933 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m11:18:13.973241 [debug] [MainThread]: On master: Close
[0m11:18:13.974397 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:18:13.975503 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m11:18:13.976695 [info ] [MainThread]: 
[0m11:18:13.977460 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.33 seconds (0.33s).
[0m11:18:13.978373 [debug] [MainThread]: Command end result
[0m11:18:14.003698 [info ] [MainThread]: 
[0m11:18:14.009133 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:18:14.015501 [info ] [MainThread]: 
[0m11:18:14.022936 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:18:14.025938 [debug] [MainThread]: Command `dbt run` succeeded at 11:18:14.025835 after 0.70 seconds
[0m11:18:14.029241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d946d64590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d946ec0150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d946ec1050>]}
[0m11:18:14.035309 [debug] [MainThread]: Flushing usage events
[0m11:33:51.784869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd4c6091810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd4c7999750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd4c6091ed0>]}


============================== 11:33:51.792239 | 578b275f-3c13-4440-b263-3df792e78bea ==============================
[0m11:33:51.792239 [info ] [MainThread]: Running with dbt=1.6.0
[0m11:33:51.794211 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt deps', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:33:51.823550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '578b275f-3c13-4440-b263-3df792e78bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd4c6a26450>]}
[0m11:33:51.825924 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m11:33:51.827028 [debug] [MainThread]: Command `dbt deps` succeeded at 11:33:51.826924 after 0.09 seconds
[0m11:33:51.827801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd4ca0505d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd4ca050550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd4ca1d4e90>]}
[0m11:33:51.828688 [debug] [MainThread]: Flushing usage events
[0m11:33:53.614575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7da5dd9c9250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7da5dd9bf150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7da5dd9c9350>]}


============================== 11:33:53.617870 | b4743a8b-4cfb-40de-a0c7-723498c81a76 ==============================
[0m11:33:53.617870 [info ] [MainThread]: Running with dbt=1.6.0
[0m11:33:53.619158 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:33:53.708142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b4743a8b-4cfb-40de-a0c7-723498c81a76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7da5dd8b7bd0>]}
[0m11:33:53.717212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b4743a8b-4cfb-40de-a0c7-723498c81a76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7da5df2a81d0>]}
[0m11:33:53.721282 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m11:33:53.765916 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m11:33:53.840051 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:33:53.841892 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:33:53.847329 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b4743a8b-4cfb-40de-a0c7-723498c81a76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7da5dd9ea390>]}
[0m11:33:53.885709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b4743a8b-4cfb-40de-a0c7-723498c81a76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7da5dc09c090>]}
[0m11:33:53.887499 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m11:33:53.889101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b4743a8b-4cfb-40de-a0c7-723498c81a76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7da5dd9b7d50>]}
[0m11:33:53.891436 [info ] [MainThread]: 
[0m11:33:53.893098 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:33:53.894916 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m11:33:53.903241 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m11:33:53.904638 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m11:33:53.905795 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:33:53.911173 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m11:33:53.913018 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m11:33:53.915255 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m11:33:53.919692 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m11:33:53.920780 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m11:33:53.921680 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:33:53.925389 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m11:33:53.926564 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m11:33:53.927485 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m11:33:53.930476 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m11:33:53.932330 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m11:33:53.933742 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m11:33:53.937512 [debug] [MainThread]: Using postgres connection "master"
[0m11:33:53.938798 [debug] [MainThread]: On master: BEGIN
[0m11:33:53.939878 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:33:53.943884 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:33:53.944993 [debug] [MainThread]: Using postgres connection "master"
[0m11:33:53.946091 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:33:53.950944 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m11:33:53.952670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b4743a8b-4cfb-40de-a0c7-723498c81a76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7da5de33de10>]}
[0m11:33:53.953868 [debug] [MainThread]: On master: ROLLBACK
[0m11:33:53.954905 [debug] [MainThread]: Using postgres connection "master"
[0m11:33:53.955897 [debug] [MainThread]: On master: BEGIN
[0m11:33:53.957585 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:33:53.958726 [debug] [MainThread]: On master: COMMIT
[0m11:33:53.960064 [debug] [MainThread]: Using postgres connection "master"
[0m11:33:53.961079 [debug] [MainThread]: On master: COMMIT
[0m11:33:53.962543 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m11:33:53.963451 [debug] [MainThread]: On master: Close
[0m11:33:53.964727 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:33:53.965787 [info ] [MainThread]: 
[0m11:33:53.971865 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m11:33:53.972928 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m11:33:53.974212 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m11:33:53.975253 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m11:33:53.980128 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m11:33:53.996106 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 11:33:53.976167 => 11:33:53.995886
[0m11:33:54.002070 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m11:33:54.028360 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m11:33:54.089675 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:33:54.091867 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m11:33:54.094662 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:33:54.100930 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m11:33:54.103521 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:33:54.108118 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m11:33:54.113328 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.0 seconds
[0m11:33:54.118616 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:33:54.120169 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m11:33:54.122112 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m11:33:54.134825 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m11:33:54.136706 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:33:54.138449 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m11:33:54.141226 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m11:33:54.147761 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:33:54.149166 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m11:33:54.150862 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m11:33:54.152965 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 11:33:54.006421 => 11:33:54.152856
[0m11:33:54.154389 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m11:33:54.155886 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4743a8b-4cfb-40de-a0c7-723498c81a76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7da5dc0f9990>]}
[0m11:33:54.157151 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 0[0m in 0.18s]
[0m11:33:54.158368 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m11:33:54.167178 [debug] [MainThread]: Using postgres connection "master"
[0m11:33:54.168423 [debug] [MainThread]: On master: BEGIN
[0m11:33:54.169841 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:33:54.174088 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:33:54.175334 [debug] [MainThread]: On master: COMMIT
[0m11:33:54.176466 [debug] [MainThread]: Using postgres connection "master"
[0m11:33:54.177496 [debug] [MainThread]: On master: COMMIT
[0m11:33:54.178585 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m11:33:54.179489 [debug] [MainThread]: On master: Close
[0m11:33:54.180925 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:33:54.183725 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m11:33:54.184886 [info ] [MainThread]: 
[0m11:33:54.185983 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.29 seconds (0.29s).
[0m11:33:54.187144 [debug] [MainThread]: Command end result
[0m11:33:54.232622 [info ] [MainThread]: 
[0m11:33:54.239655 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:33:54.241154 [info ] [MainThread]: 
[0m11:33:54.247262 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:33:54.253764 [debug] [MainThread]: Command `dbt run` succeeded at 11:33:54.253664 after 0.66 seconds
[0m11:33:54.257731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7da5e1a52250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7da5e196c550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7da5def3b110>]}
[0m11:33:54.265753 [debug] [MainThread]: Flushing usage events
[0m11:37:20.759586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x739c611de3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x739c611ddf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x739c611de650>]}


============================== 11:37:20.786018 | 89af53ca-a65c-4647-8550-777664636ad2 ==============================
[0m11:37:20.786018 [info ] [MainThread]: Running with dbt=1.6.0
[0m11:37:20.798594 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt deps', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:37:20.958746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '89af53ca-a65c-4647-8550-777664636ad2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x739c6121f190>]}
[0m11:37:21.045662 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m11:37:21.066731 [debug] [MainThread]: Command `dbt deps` succeeded at 11:37:21.066580 after 0.71 seconds
[0m11:37:21.089372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x739c611be2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x739c611be410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x739c611dca50>]}
[0m11:37:21.115247 [debug] [MainThread]: Flushing usage events
[0m11:37:23.463230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7988655690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f798864f990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f798864f710>]}


============================== 11:37:23.466763 | b1289ba2-e63c-4fa5-a107-15b5127f8dd9 ==============================
[0m11:37:23.466763 [info ] [MainThread]: Running with dbt=1.6.0
[0m11:37:23.468025 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m11:37:23.618691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b1289ba2-e63c-4fa5-a107-15b5127f8dd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7988fca0d0>]}
[0m11:37:23.625535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b1289ba2-e63c-4fa5-a107-15b5127f8dd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7988548710>]}
[0m11:37:23.627924 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m11:37:23.645984 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m11:37:23.719925 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:37:23.723020 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:37:23.729031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b1289ba2-e63c-4fa5-a107-15b5127f8dd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7988fc9f90>]}
[0m11:37:23.780876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b1289ba2-e63c-4fa5-a107-15b5127f8dd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7986d28310>]}
[0m11:37:23.783002 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m11:37:23.784913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b1289ba2-e63c-4fa5-a107-15b5127f8dd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f798864f150>]}
[0m11:37:23.787801 [info ] [MainThread]: 
[0m11:37:23.790617 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:37:23.794029 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m11:37:23.805516 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m11:37:23.807709 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m11:37:23.809455 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:37:23.819779 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m11:37:23.822679 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m11:37:23.825091 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m11:37:23.830877 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m11:37:23.832339 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m11:37:23.833446 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:37:23.838875 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m11:37:23.841399 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m11:37:23.844778 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m11:37:23.855652 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m11:37:23.860070 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m11:37:23.863600 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m11:37:23.869111 [debug] [MainThread]: Using postgres connection "master"
[0m11:37:23.870518 [debug] [MainThread]: On master: BEGIN
[0m11:37:23.871681 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:37:23.877707 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:37:23.880027 [debug] [MainThread]: Using postgres connection "master"
[0m11:37:23.884212 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:37:23.892214 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m11:37:23.895338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b1289ba2-e63c-4fa5-a107-15b5127f8dd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79891f3010>]}
[0m11:37:23.899895 [debug] [MainThread]: On master: ROLLBACK
[0m11:37:23.902052 [debug] [MainThread]: Using postgres connection "master"
[0m11:37:23.905287 [debug] [MainThread]: On master: BEGIN
[0m11:37:23.907400 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:37:23.909160 [debug] [MainThread]: On master: COMMIT
[0m11:37:23.910285 [debug] [MainThread]: Using postgres connection "master"
[0m11:37:23.911452 [debug] [MainThread]: On master: COMMIT
[0m11:37:23.913449 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m11:37:23.914660 [debug] [MainThread]: On master: Close
[0m11:37:23.916287 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:37:23.918492 [info ] [MainThread]: 
[0m11:37:23.926107 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m11:37:23.929354 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m11:37:23.932513 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m11:37:23.933747 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m11:37:23.940447 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m11:37:23.959302 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 11:37:23.935397 => 11:37:23.959040
[0m11:37:23.961064 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m11:37:23.990776 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m11:37:24.008821 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:37:24.010737 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m11:37:24.017357 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:37:24.024769 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m11:37:24.027215 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:37:24.029166 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m11:37:24.053208 [debug] [Thread-1 (]: SQL status: SELECT 22 in 0.0 seconds
[0m11:37:24.062715 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:37:24.068857 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution" rename to "clean_pollution__dbt_backup"
[0m11:37:24.073307 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m11:37:24.082956 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:37:24.086583 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m11:37:24.090414 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m11:37:24.107072 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m11:37:24.113343 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:37:24.117349 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m11:37:24.135087 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m11:37:24.147012 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:37:24.149403 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m11:37:24.157000 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m11:37:24.161964 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 11:37:23.962232 => 11:37:24.161007
[0m11:37:24.172907 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m11:37:24.181401 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1289ba2-e63c-4fa5-a107-15b5127f8dd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f798867b710>]}
[0m11:37:24.189182 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 22[0m in 0.25s]
[0m11:37:24.191872 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m11:37:24.218092 [debug] [MainThread]: Using postgres connection "master"
[0m11:37:24.219322 [debug] [MainThread]: On master: BEGIN
[0m11:37:24.224811 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:37:24.229280 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:37:24.230436 [debug] [MainThread]: On master: COMMIT
[0m11:37:24.231377 [debug] [MainThread]: Using postgres connection "master"
[0m11:37:24.233907 [debug] [MainThread]: On master: COMMIT
[0m11:37:24.237339 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m11:37:24.239828 [debug] [MainThread]: On master: Close
[0m11:37:24.243000 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:37:24.245610 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m11:37:24.247334 [info ] [MainThread]: 
[0m11:37:24.248909 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.46 seconds (0.46s).
[0m11:37:24.250333 [debug] [MainThread]: Command end result
[0m11:37:24.302562 [info ] [MainThread]: 
[0m11:37:24.309516 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:37:24.311179 [info ] [MainThread]: 
[0m11:37:24.312868 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:37:24.315822 [debug] [MainThread]: Command `dbt run` succeeded at 11:37:24.315588 after 0.88 seconds
[0m11:37:24.317869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f798c6de3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f798c5f8550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7988643f50>]}
[0m11:37:24.321453 [debug] [MainThread]: Flushing usage events
[0m11:40:31.515283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b6a803c110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b6a8043b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b6a803e050>]}


============================== 11:40:31.540254 | aeafac12-73f5-47ce-85a9-52104b747b13 ==============================
[0m11:40:31.540254 [info ] [MainThread]: Running with dbt=1.6.0
[0m11:40:31.558697 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt deps', 'send_anonymous_usage_stats': 'True'}
[0m11:40:31.721349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aeafac12-73f5-47ce-85a9-52104b747b13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b6a8082a90>]}
[0m11:40:31.779189 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m11:40:31.792306 [debug] [MainThread]: Command `dbt deps` succeeded at 11:40:31.792112 after 0.52 seconds
[0m11:40:31.806676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b6ac038610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b6ac038590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b6a99e1810>]}
[0m11:40:31.823018 [debug] [MainThread]: Flushing usage events
[0m11:40:33.951612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a23d2d8dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a23d829250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a23d2caf10>]}


============================== 11:40:33.955748 | fb1401a8-953e-48ed-8781-dad75cb4cf05 ==============================
[0m11:40:33.955748 [info ] [MainThread]: Running with dbt=1.6.0
[0m11:40:33.957437 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m11:40:34.092136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fb1401a8-953e-48ed-8781-dad75cb4cf05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a23bb47390>]}
[0m11:40:34.099443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fb1401a8-953e-48ed-8781-dad75cb4cf05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a23bb4be50>]}
[0m11:40:34.101598 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m11:40:34.128412 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m11:40:34.200034 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:40:34.201445 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:40:34.206955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fb1401a8-953e-48ed-8781-dad75cb4cf05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a23d302c50>]}
[0m11:40:34.250200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fb1401a8-953e-48ed-8781-dad75cb4cf05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a23bba4150>]}
[0m11:40:34.251680 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m11:40:34.253003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb1401a8-953e-48ed-8781-dad75cb4cf05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a240498390>]}
[0m11:40:34.255089 [info ] [MainThread]: 
[0m11:40:34.256904 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:40:34.259050 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m11:40:34.266520 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m11:40:34.267911 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m11:40:34.268991 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:40:34.274585 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m11:40:34.276933 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m11:40:34.279266 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m11:40:34.283780 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m11:40:34.284981 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m11:40:34.286649 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:40:34.290466 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m11:40:34.291882 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m11:40:34.293107 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m11:40:34.295953 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m11:40:34.297591 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m11:40:34.298772 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m11:40:34.303011 [debug] [MainThread]: Using postgres connection "master"
[0m11:40:34.304308 [debug] [MainThread]: On master: BEGIN
[0m11:40:34.305351 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:40:34.309574 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:40:34.311998 [debug] [MainThread]: Using postgres connection "master"
[0m11:40:34.313897 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:40:34.319279 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m11:40:34.322055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb1401a8-953e-48ed-8781-dad75cb4cf05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a23d308090>]}
[0m11:40:34.324750 [debug] [MainThread]: On master: ROLLBACK
[0m11:40:34.327920 [debug] [MainThread]: Using postgres connection "master"
[0m11:40:34.330283 [debug] [MainThread]: On master: BEGIN
[0m11:40:34.332547 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:40:34.333785 [debug] [MainThread]: On master: COMMIT
[0m11:40:34.334984 [debug] [MainThread]: Using postgres connection "master"
[0m11:40:34.335874 [debug] [MainThread]: On master: COMMIT
[0m11:40:34.336964 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m11:40:34.337879 [debug] [MainThread]: On master: Close
[0m11:40:34.339316 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:40:34.340511 [info ] [MainThread]: 
[0m11:40:34.346543 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m11:40:34.348729 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m11:40:34.353172 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m11:40:34.355007 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m11:40:34.361025 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m11:40:34.378292 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 11:40:34.356895 => 11:40:34.378045
[0m11:40:34.380574 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m11:40:34.404420 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m11:40:34.423017 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:40:34.424093 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m11:40:34.425176 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:40:34.429377 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m11:40:34.431127 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:40:34.432698 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m11:40:34.439275 [debug] [Thread-1 (]: SQL status: SELECT 11 in 0.0 seconds
[0m11:40:34.444224 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:40:34.445443 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m11:40:34.446712 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m11:40:34.458557 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m11:40:34.460302 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:40:34.461614 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m11:40:34.464692 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m11:40:34.471277 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:40:34.472662 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m11:40:34.474096 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m11:40:34.475903 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 11:40:34.382910 => 11:40:34.475784
[0m11:40:34.476877 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m11:40:34.478143 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb1401a8-953e-48ed-8781-dad75cb4cf05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a23ba51510>]}
[0m11:40:34.479776 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 11[0m in 0.13s]
[0m11:40:34.481202 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m11:40:34.491952 [debug] [MainThread]: Using postgres connection "master"
[0m11:40:34.493097 [debug] [MainThread]: On master: BEGIN
[0m11:40:34.494224 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:40:34.497821 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:40:34.499165 [debug] [MainThread]: On master: COMMIT
[0m11:40:34.500364 [debug] [MainThread]: Using postgres connection "master"
[0m11:40:34.502167 [debug] [MainThread]: On master: COMMIT
[0m11:40:34.505001 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m11:40:34.509144 [debug] [MainThread]: On master: Close
[0m11:40:34.512633 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:40:34.517359 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m11:40:34.518769 [info ] [MainThread]: 
[0m11:40:34.521220 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m11:40:34.524009 [debug] [MainThread]: Command end result
[0m11:40:34.562528 [info ] [MainThread]: 
[0m11:40:34.564073 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:40:34.565203 [info ] [MainThread]: 
[0m11:40:34.566520 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:40:34.568104 [debug] [MainThread]: Command `dbt run` succeeded at 11:40:34.568021 after 0.65 seconds
[0m11:40:34.569815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a2412c0590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a24141c150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77a24141d050>]}
[0m11:40:34.571454 [debug] [MainThread]: Flushing usage events
[0m11:57:23.088571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f923734d790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9237e92450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f923735bfd0>]}


============================== 11:57:23.093376 | f48b5b5d-46e6-4946-8e37-c22f3bf48bd3 ==============================
[0m11:57:23.093376 [info ] [MainThread]: Running with dbt=1.6.0
[0m11:57:23.094414 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt deps', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:57:23.113297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f48b5b5d-46e6-4946-8e37-c22f3bf48bd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f923736cf10>]}
[0m11:57:23.116051 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m11:57:23.116991 [debug] [MainThread]: Command `dbt deps` succeeded at 11:57:23.116893 after 0.04 seconds
[0m11:57:23.117668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f923b4aa210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f923b4a8510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f923b4aaf50>]}
[0m11:57:23.119189 [debug] [MainThread]: Flushing usage events
[0m11:57:25.299280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bc23b21810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bc23b129d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bc23b21990>]}


============================== 11:57:25.312928 | ea8abdd2-186f-4d08-9f03-09da06314ad3 ==============================
[0m11:57:25.312928 [info ] [MainThread]: Running with dbt=1.6.0
[0m11:57:25.320446 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:57:25.502076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ea8abdd2-186f-4d08-9f03-09da06314ad3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bc23b39410>]}
[0m11:57:25.515625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ea8abdd2-186f-4d08-9f03-09da06314ad3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bc22397e90>]}
[0m11:57:25.526867 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m11:57:25.556997 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m11:57:25.667563 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:25.669327 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:25.678430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ea8abdd2-186f-4d08-9f03-09da06314ad3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bc23b4c110>]}
[0m11:57:25.727821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ea8abdd2-186f-4d08-9f03-09da06314ad3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bc223f00d0>]}
[0m11:57:25.729635 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m11:57:25.731391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ea8abdd2-186f-4d08-9f03-09da06314ad3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bc23b13710>]}
[0m11:57:25.736948 [info ] [MainThread]: 
[0m11:57:25.738941 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:57:25.741179 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m11:57:25.749692 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m11:57:25.751598 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m11:57:25.753014 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:25.759198 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m11:57:25.761325 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m11:57:25.764138 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m11:57:25.769406 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m11:57:25.770706 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m11:57:25.772461 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:57:25.777788 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m11:57:25.779665 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m11:57:25.781051 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m11:57:25.784418 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m11:57:25.786638 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m11:57:25.788299 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m11:57:25.793577 [debug] [MainThread]: Using postgres connection "master"
[0m11:57:25.794709 [debug] [MainThread]: On master: BEGIN
[0m11:57:25.795927 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:57:25.800750 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:57:25.802449 [debug] [MainThread]: Using postgres connection "master"
[0m11:57:25.804079 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:57:25.810435 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m11:57:25.812625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ea8abdd2-186f-4d08-9f03-09da06314ad3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bc23b3a450>]}
[0m11:57:25.814527 [debug] [MainThread]: On master: ROLLBACK
[0m11:57:25.816510 [debug] [MainThread]: Using postgres connection "master"
[0m11:57:25.817870 [debug] [MainThread]: On master: BEGIN
[0m11:57:25.819124 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:57:25.820798 [debug] [MainThread]: On master: COMMIT
[0m11:57:25.822428 [debug] [MainThread]: Using postgres connection "master"
[0m11:57:25.823868 [debug] [MainThread]: On master: COMMIT
[0m11:57:25.825098 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m11:57:25.826734 [debug] [MainThread]: On master: Close
[0m11:57:25.828810 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:57:25.830253 [info ] [MainThread]: 
[0m11:57:25.836421 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m11:57:25.838313 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m11:57:25.840098 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m11:57:25.841703 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m11:57:25.847866 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m11:57:25.863504 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 11:57:25.842451 => 11:57:25.863206
[0m11:57:25.865225 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m11:57:25.891393 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m11:57:25.905942 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:57:25.907296 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m11:57:25.909949 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:57:25.916248 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m11:57:25.917993 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:57:25.919220 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m11:57:25.939114 [debug] [Thread-1 (]: SQL status: SELECT 33 in 0.0 seconds
[0m11:57:25.945079 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:57:25.947595 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution" rename to "clean_pollution__dbt_backup"
[0m11:57:25.949527 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m11:57:25.953386 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:57:25.955255 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m11:57:25.956629 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m11:57:25.969952 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m11:57:25.971849 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:57:25.973131 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m11:57:25.975421 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m11:57:25.982509 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m11:57:25.984299 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m11:57:25.988022 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m11:57:25.990200 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 11:57:25.867813 => 11:57:25.990080
[0m11:57:25.991287 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m11:57:25.993001 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ea8abdd2-186f-4d08-9f03-09da06314ad3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bc22243b90>]}
[0m11:57:25.994261 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 33[0m in 0.15s]
[0m11:57:25.995755 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m11:57:26.006577 [debug] [MainThread]: Using postgres connection "master"
[0m11:57:26.008073 [debug] [MainThread]: On master: BEGIN
[0m11:57:26.009598 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:57:26.014369 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:57:26.016084 [debug] [MainThread]: On master: COMMIT
[0m11:57:26.017216 [debug] [MainThread]: Using postgres connection "master"
[0m11:57:26.018091 [debug] [MainThread]: On master: COMMIT
[0m11:57:26.019090 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m11:57:26.020054 [debug] [MainThread]: On master: Close
[0m11:57:26.021296 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:26.022303 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m11:57:26.023702 [info ] [MainThread]: 
[0m11:57:26.024963 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.29 seconds (0.29s).
[0m11:57:26.026687 [debug] [MainThread]: Command end result
[0m11:57:26.055837 [info ] [MainThread]: 
[0m11:57:26.057385 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:57:26.058515 [info ] [MainThread]: 
[0m11:57:26.059534 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:57:26.060801 [debug] [MainThread]: Command `dbt run` succeeded at 11:57:26.060686 after 0.87 seconds
[0m11:57:26.061977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bc27b20590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bc27c7c050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bc27c7d050>]}
[0m11:57:26.063707 [debug] [MainThread]: Flushing usage events
[0m12:03:01.517898 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d29416b5910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d294317ed10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2942dfb750>]}


============================== 12:03:01.546968 | aa02d820-2a17-4c50-a9cd-8e0200413069 ==============================
[0m12:03:01.546968 [info ] [MainThread]: Running with dbt=1.6.0
[0m12:03:01.566964 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:03:01.773818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aa02d820-2a17-4c50-a9cd-8e0200413069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2943a32cd0>]}
[0m12:03:01.861188 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m12:03:01.887853 [debug] [MainThread]: Command `dbt deps` succeeded at 12:03:01.887705 after 0.70 seconds
[0m12:03:01.909543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d29416c3fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d29416a67d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2945810490>]}
[0m12:03:01.931634 [debug] [MainThread]: Flushing usage events
[0m12:03:03.918181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76208440d250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76208440d6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76208440ddd0>]}


============================== 12:03:03.921083 | aa65a84a-0c75-452a-932a-f249874f6692 ==============================
[0m12:03:03.921083 [info ] [MainThread]: Running with dbt=1.6.0
[0m12:03:03.922291 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m12:03:04.010439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aa65a84a-0c75-452a-932a-f249874f6692', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x762084431a50>]}
[0m12:03:04.016722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aa65a84a-0c75-452a-932a-f249874f6692', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x762082c7fe10>]}
[0m12:03:04.018502 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m12:03:04.034270 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m12:03:04.095770 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:03:04.097491 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:03:04.103024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aa65a84a-0c75-452a-932a-f249874f6692', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x762084427310>]}
[0m12:03:04.145327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aa65a84a-0c75-452a-932a-f249874f6692', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x762082cd8150>]}
[0m12:03:04.147039 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m12:03:04.149833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aa65a84a-0c75-452a-932a-f249874f6692', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7620843fda90>]}
[0m12:03:04.153997 [info ] [MainThread]: 
[0m12:03:04.156233 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:03:04.157719 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m12:03:04.164713 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m12:03:04.165820 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m12:03:04.167547 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:03:04.174335 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m12:03:04.176742 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m12:03:04.179041 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m12:03:04.184427 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m12:03:04.185282 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m12:03:04.186074 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:03:04.191187 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:03:04.192590 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m12:03:04.193485 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:03:04.196250 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m12:03:04.199445 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m12:03:04.201352 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m12:03:04.205595 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:04.207076 [debug] [MainThread]: On master: BEGIN
[0m12:03:04.208047 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:03:04.211917 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:03:04.213071 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:04.213853 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:03:04.218394 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m12:03:04.220143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aa65a84a-0c75-452a-932a-f249874f6692', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x762084427d50>]}
[0m12:03:04.221201 [debug] [MainThread]: On master: ROLLBACK
[0m12:03:04.222207 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:04.223010 [debug] [MainThread]: On master: BEGIN
[0m12:03:04.224109 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:03:04.225103 [debug] [MainThread]: On master: COMMIT
[0m12:03:04.225809 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:04.226469 [debug] [MainThread]: On master: COMMIT
[0m12:03:04.227789 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:03:04.228600 [debug] [MainThread]: On master: Close
[0m12:03:04.229521 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:03:04.230539 [info ] [MainThread]: 
[0m12:03:04.237422 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m12:03:04.238868 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m12:03:04.240157 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m12:03:04.240992 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m12:03:04.245978 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m12:03:04.268200 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 12:03:04.241768 => 12:03:04.267863
[0m12:03:04.270131 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m12:03:04.299003 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m12:03:04.312131 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m12:03:04.313835 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m12:03:04.314984 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:03:04.318950 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m12:03:04.323317 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m12:03:04.325155 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m12:03:04.335058 [debug] [Thread-1 (]: SQL status: SELECT 11 in 0.0 seconds
[0m12:03:04.343180 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m12:03:04.344772 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m12:03:04.346653 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:03:04.358293 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m12:03:04.359944 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m12:03:04.361190 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m12:03:04.363700 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m12:03:04.370303 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m12:03:04.372545 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m12:03:04.374294 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m12:03:04.376285 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 12:03:04.271527 => 12:03:04.376160
[0m12:03:04.377388 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m12:03:04.379149 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa65a84a-0c75-452a-932a-f249874f6692', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x762082afa9d0>]}
[0m12:03:04.382134 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 11[0m in 0.14s]
[0m12:03:04.383512 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m12:03:04.397313 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:04.398444 [debug] [MainThread]: On master: BEGIN
[0m12:03:04.399530 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:03:04.403433 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:03:04.404980 [debug] [MainThread]: On master: COMMIT
[0m12:03:04.406372 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:04.407645 [debug] [MainThread]: On master: COMMIT
[0m12:03:04.409105 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:03:04.410196 [debug] [MainThread]: On master: Close
[0m12:03:04.411484 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:03:04.412919 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m12:03:04.413615 [info ] [MainThread]: 
[0m12:03:04.414760 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m12:03:04.416291 [debug] [MainThread]: Command end result
[0m12:03:04.465504 [info ] [MainThread]: 
[0m12:03:04.467814 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:03:04.471321 [info ] [MainThread]: 
[0m12:03:04.472666 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m12:03:04.473927 [debug] [MainThread]: Command `dbt run` succeeded at 12:03:04.473839 after 0.58 seconds
[0m12:03:04.475067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x762085c6d8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x762085c63090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7620883f4590>]}
[0m12:03:04.476215 [debug] [MainThread]: Flushing usage events
[0m14:23:58.936600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d92d3ac9ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d92d3ad7a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d92d3aca1d0>]}


============================== 14:23:58.947032 | 44536d23-f9c1-4f26-8cea-df00b4016427 ==============================
[0m14:23:58.947032 [info ] [MainThread]: Running with dbt=1.6.0
[0m14:23:58.947779 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt deps', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:23:58.989666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '44536d23-f9c1-4f26-8cea-df00b4016427', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d92d3ae8f10>]}
[0m14:23:58.990652 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m14:23:58.991440 [debug] [MainThread]: Command `dbt deps` succeeded at 14:23:58.991255 after 0.07 seconds
[0m14:23:58.991945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d92d3ad7c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d92d7c24510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d92d7c24490>]}
[0m14:23:58.992444 [debug] [MainThread]: Flushing usage events
[0m14:23:59.006040 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m14:24:01.874662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709c30e41310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709c30e41810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709c30e418d0>]}


============================== 14:24:01.880040 | d76bb24e-ebb1-45b7-9944-7680ae34019b ==============================
[0m14:24:01.880040 [info ] [MainThread]: Running with dbt=1.6.0
[0m14:24:01.880831 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:24:02.016789 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd76bb24e-ebb1-45b7-9944-7680ae34019b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709c30e41bd0>]}
[0m14:24:02.028654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd76bb24e-ebb1-45b7-9944-7680ae34019b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709c30d0fb90>]}
[0m14:24:02.030305 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m14:24:02.043446 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m14:24:02.081307 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:24:02.081973 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:24:02.097101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd76bb24e-ebb1-45b7-9944-7680ae34019b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709c30d204d0>]}
[0m14:24:02.110676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd76bb24e-ebb1-45b7-9944-7680ae34019b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709c2f514050>]}
[0m14:24:02.111432 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m14:24:02.112013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd76bb24e-ebb1-45b7-9944-7680ae34019b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709c30e32410>]}
[0m14:24:02.114149 [info ] [MainThread]: 
[0m14:24:02.115660 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:24:02.118495 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m14:24:02.150824 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m14:24:02.152221 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m14:24:02.153177 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:24:02.173713 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m14:24:02.178229 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m14:24:02.181816 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m14:24:02.196410 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m14:24:02.197092 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m14:24:02.197514 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:24:02.206208 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m14:24:02.207211 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m14:24:02.207819 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m14:24:02.214579 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m14:24:02.216998 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m14:24:02.217805 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m14:24:02.225547 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:02.226024 [debug] [MainThread]: On master: BEGIN
[0m14:24:02.226371 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:24:02.233504 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:24:02.233983 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:02.234419 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:24:02.243382 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m14:24:02.245043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd76bb24e-ebb1-45b7-9944-7680ae34019b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709c30d20090>]}
[0m14:24:02.245630 [debug] [MainThread]: On master: ROLLBACK
[0m14:24:02.246431 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:02.246915 [debug] [MainThread]: On master: BEGIN
[0m14:24:02.248145 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:24:02.248648 [debug] [MainThread]: On master: COMMIT
[0m14:24:02.249039 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:02.249391 [debug] [MainThread]: On master: COMMIT
[0m14:24:02.249865 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:24:02.250214 [debug] [MainThread]: On master: Close
[0m14:24:02.251401 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:24:02.251931 [info ] [MainThread]: 
[0m14:24:02.270812 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m14:24:02.271691 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m14:24:02.272808 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m14:24:02.273371 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m14:24:02.283841 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m14:24:02.284996 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 14:24:02.273737 => 14:24:02.284639
[0m14:24:02.285561 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m14:24:02.334219 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m14:24:02.335248 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:24:02.335655 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m14:24:02.336005 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:24:02.341865 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m14:24:02.342538 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:24:02.343090 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m14:24:02.349389 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.0 seconds
[0m14:24:02.357949 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:24:02.358472 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m14:24:02.359929 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:24:02.382150 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m14:24:02.382684 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:24:02.383050 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m14:24:02.384555 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m14:24:02.394919 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:24:02.395407 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m14:24:02.396273 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m14:24:02.398323 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 14:24:02.285894 => 14:24:02.398056
[0m14:24:02.398825 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m14:24:02.399983 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd76bb24e-ebb1-45b7-9944-7680ae34019b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709c2f5449d0>]}
[0m14:24:02.400842 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 0[0m in 0.13s]
[0m14:24:02.401608 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m14:24:02.406574 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:02.407483 [debug] [MainThread]: On master: BEGIN
[0m14:24:02.408221 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:24:02.417096 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:24:02.418067 [debug] [MainThread]: On master: COMMIT
[0m14:24:02.418833 [debug] [MainThread]: Using postgres connection "master"
[0m14:24:02.419550 [debug] [MainThread]: On master: COMMIT
[0m14:24:02.420744 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:24:02.421634 [debug] [MainThread]: On master: Close
[0m14:24:02.423337 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:24:02.424080 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m14:24:02.424465 [info ] [MainThread]: 
[0m14:24:02.424826 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.31 seconds (0.31s).
[0m14:24:02.425484 [debug] [MainThread]: Command end result
[0m14:24:02.436247 [info ] [MainThread]: 
[0m14:24:02.436776 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:24:02.437104 [info ] [MainThread]: 
[0m14:24:02.437438 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m14:24:02.438039 [debug] [MainThread]: Command `dbt run` succeeded at 14:24:02.437908 after 0.57 seconds
[0m14:24:02.438429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709c317b1b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709c34dd0490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709c316f5890>]}
[0m14:24:02.438897 [debug] [MainThread]: Flushing usage events
[0m14:24:02.444370 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m14:25:42.134290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b21d626490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b21d6374d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b21d626050>]}


============================== 14:25:42.143005 | cbd523e3-f81f-4511-9f8b-63eba0518d7d ==============================
[0m14:25:42.143005 [info ] [MainThread]: Running with dbt=1.6.0
[0m14:25:42.143947 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt deps', 'send_anonymous_usage_stats': 'True'}
[0m14:25:42.176234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cbd523e3-f81f-4511-9f8b-63eba0518d7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b21d625910>]}
[0m14:25:42.177067 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m14:25:42.177844 [debug] [MainThread]: Command `dbt deps` succeeded at 14:25:42.177660 after 0.05 seconds
[0m14:25:42.178340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b21efca8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b22177c210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b22177cf10>]}
[0m14:25:42.178856 [debug] [MainThread]: Flushing usage events
[0m14:25:42.186765 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m14:25:44.976683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bdce8e1010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bdce8d2790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bdce8dbfd0>]}


============================== 14:25:44.981119 | a75158d6-a074-4258-bc71-daafdae0ed5e ==============================
[0m14:25:44.981119 [info ] [MainThread]: Running with dbt=1.6.0
[0m14:25:44.981999 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m14:25:45.084841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a75158d6-a074-4258-bc71-daafdae0ed5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bdce7cfc10>]}
[0m14:25:45.097087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a75158d6-a074-4258-bc71-daafdae0ed5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bdce7d5390>]}
[0m14:25:45.098262 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m14:25:45.110891 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m14:25:45.134473 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:25:45.135112 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:25:45.147980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a75158d6-a074-4258-bc71-daafdae0ed5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bdcee296d0>]}
[0m14:25:45.160078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a75158d6-a074-4258-bc71-daafdae0ed5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bdccfb4950>]}
[0m14:25:45.160748 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m14:25:45.161285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a75158d6-a074-4258-bc71-daafdae0ed5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bdce8dbf90>]}
[0m14:25:45.163077 [info ] [MainThread]: 
[0m14:25:45.164200 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:25:45.166586 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m14:25:45.183102 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m14:25:45.183597 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m14:25:45.183914 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:25:45.191818 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m14:25:45.194351 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m14:25:45.197422 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m14:25:45.207224 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m14:25:45.207673 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m14:25:45.207983 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:25:45.214564 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m14:25:45.215132 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m14:25:45.215557 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m14:25:45.220222 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m14:25:45.222992 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m14:25:45.223813 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m14:25:45.231529 [debug] [MainThread]: Using postgres connection "master"
[0m14:25:45.232090 [debug] [MainThread]: On master: BEGIN
[0m14:25:45.232460 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:25:45.238724 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:25:45.239336 [debug] [MainThread]: Using postgres connection "master"
[0m14:25:45.239936 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:25:45.250501 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m14:25:45.252813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a75158d6-a074-4258-bc71-daafdae0ed5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bdce7d41d0>]}
[0m14:25:45.253616 [debug] [MainThread]: On master: ROLLBACK
[0m14:25:45.254492 [debug] [MainThread]: Using postgres connection "master"
[0m14:25:45.255004 [debug] [MainThread]: On master: BEGIN
[0m14:25:45.255984 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:25:45.256490 [debug] [MainThread]: On master: COMMIT
[0m14:25:45.256915 [debug] [MainThread]: Using postgres connection "master"
[0m14:25:45.257340 [debug] [MainThread]: On master: COMMIT
[0m14:25:45.258202 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:25:45.258734 [debug] [MainThread]: On master: Close
[0m14:25:45.259737 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:25:45.260208 [info ] [MainThread]: 
[0m14:25:45.272199 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m14:25:45.273784 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m14:25:45.275128 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m14:25:45.275744 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m14:25:45.285983 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m14:25:45.287100 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 14:25:45.276113 => 14:25:45.286744
[0m14:25:45.287645 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m14:25:45.336140 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m14:25:45.337435 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:25:45.338002 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m14:25:45.338464 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:25:45.348150 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m14:25:45.349486 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:25:45.350705 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m14:25:45.358680 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.0 seconds
[0m14:25:45.378301 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:25:45.379832 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m14:25:45.382224 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:25:45.409398 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m14:25:45.410291 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:25:45.410979 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m14:25:45.413109 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m14:25:45.439761 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:25:45.441191 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m14:25:45.443043 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m14:25:45.448197 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 14:25:45.287961 => 14:25:45.447351
[0m14:25:45.449404 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m14:25:45.451699 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a75158d6-a074-4258-bc71-daafdae0ed5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bdccef2250>]}
[0m14:25:45.453424 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 0[0m in 0.18s]
[0m14:25:45.455174 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m14:25:45.459732 [debug] [MainThread]: Using postgres connection "master"
[0m14:25:45.460214 [debug] [MainThread]: On master: BEGIN
[0m14:25:45.460571 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:25:45.467899 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:25:45.468630 [debug] [MainThread]: On master: COMMIT
[0m14:25:45.469186 [debug] [MainThread]: Using postgres connection "master"
[0m14:25:45.469700 [debug] [MainThread]: On master: COMMIT
[0m14:25:45.470331 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:25:45.470942 [debug] [MainThread]: On master: Close
[0m14:25:45.472095 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:25:45.472578 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m14:25:45.473053 [info ] [MainThread]: 
[0m14:25:45.473596 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.31 seconds (0.31s).
[0m14:25:45.474744 [debug] [MainThread]: Command end result
[0m14:25:45.487778 [info ] [MainThread]: 
[0m14:25:45.488439 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:25:45.488895 [info ] [MainThread]: 
[0m14:25:45.489353 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m14:25:45.490150 [debug] [MainThread]: Command `dbt run` succeeded at 14:25:45.489976 after 0.52 seconds
[0m14:25:45.490687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bdd2870490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bdd29f4190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77bdcfd6ac90>]}
[0m14:25:45.491205 [debug] [MainThread]: Flushing usage events
[0m14:25:45.496693 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m14:39:43.294570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c736dd29d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c736e18f490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c736dd29e90>]}


============================== 14:39:43.314497 | 30b3c8ff-0619-432b-9bbc-6756a56418f9 ==============================
[0m14:39:43.314497 [info ] [MainThread]: Running with dbt=1.6.0
[0m14:39:43.316252 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt deps', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:39:43.363654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '30b3c8ff-0619-432b-9bbc-6756a56418f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c736dbb83d0>]}
[0m14:39:43.365013 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m14:39:43.366455 [debug] [MainThread]: Command `dbt deps` succeeded at 14:39:43.366166 after 0.08 seconds
[0m14:39:43.367344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7371cf0590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7371cf0510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7371e74e50>]}
[0m14:39:43.368226 [debug] [MainThread]: Flushing usage events
[0m14:39:43.383999 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m14:39:47.682229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7585d8dedb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7585d8de3150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7585d8decf90>]}


============================== 14:39:47.688758 | 8bf33851-fce4-4ae3-96d2-11f6eeb74da0 ==============================
[0m14:39:47.688758 [info ] [MainThread]: Running with dbt=1.6.0
[0m14:39:47.690185 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m14:39:47.873240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8bf33851-fce4-4ae3-96d2-11f6eeb74da0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7585d8ded550>]}
[0m14:39:47.888431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8bf33851-fce4-4ae3-96d2-11f6eeb74da0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7585d8de3b10>]}
[0m14:39:47.889710 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m14:39:47.903853 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m14:39:47.927958 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:39:47.928585 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:39:47.958413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8bf33851-fce4-4ae3-96d2-11f6eeb74da0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7585da6d9d90>]}
[0m14:39:47.974987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8bf33851-fce4-4ae3-96d2-11f6eeb74da0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7585d74c4310>]}
[0m14:39:47.976008 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m14:39:47.976877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8bf33851-fce4-4ae3-96d2-11f6eeb74da0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7585d8ddfa90>]}
[0m14:39:47.979095 [info ] [MainThread]: 
[0m14:39:47.980419 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:39:47.982187 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m14:39:47.998268 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m14:39:47.999083 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m14:39:47.999713 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:39:48.013245 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m14:39:48.016030 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m14:39:48.020108 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m14:39:48.038436 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m14:39:48.039662 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m14:39:48.040462 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:39:48.048870 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m14:39:48.049994 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m14:39:48.050704 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m14:39:48.055752 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m14:39:48.058426 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m14:39:48.060200 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m14:39:48.070490 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:48.071163 [debug] [MainThread]: On master: BEGIN
[0m14:39:48.071574 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:39:48.079355 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:39:48.080762 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:48.081495 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:39:48.092674 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m14:39:48.096813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8bf33851-fce4-4ae3-96d2-11f6eeb74da0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7585d8ca0690>]}
[0m14:39:48.097834 [debug] [MainThread]: On master: ROLLBACK
[0m14:39:48.099162 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:48.100262 [debug] [MainThread]: On master: BEGIN
[0m14:39:48.102012 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:39:48.103011 [debug] [MainThread]: On master: COMMIT
[0m14:39:48.103877 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:48.104646 [debug] [MainThread]: On master: COMMIT
[0m14:39:48.105775 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:39:48.106245 [debug] [MainThread]: On master: Close
[0m14:39:48.107361 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:39:48.107914 [info ] [MainThread]: 
[0m14:39:48.121286 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m14:39:48.122388 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m14:39:48.124076 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m14:39:48.124986 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m14:39:48.136563 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m14:39:48.137840 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 14:39:48.125501 => 14:39:48.137449
[0m14:39:48.138416 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m14:39:48.240548 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m14:39:48.243064 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:39:48.244280 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m14:39:48.245231 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:39:48.254982 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m14:39:48.256362 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:39:48.257486 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m14:39:48.266712 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.0 seconds
[0m14:39:48.280869 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:39:48.281589 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m14:39:48.283355 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:39:48.342718 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m14:39:48.344447 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:39:48.345619 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m14:39:48.348901 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m14:39:48.368061 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:39:48.368761 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m14:39:48.369926 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m14:39:48.372457 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 14:39:48.138843 => 14:39:48.372123
[0m14:39:48.373034 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m14:39:48.374662 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8bf33851-fce4-4ae3-96d2-11f6eeb74da0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7585d8ce8550>]}
[0m14:39:48.375851 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 0[0m in 0.25s]
[0m14:39:48.376779 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m14:39:48.381164 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:48.382245 [debug] [MainThread]: On master: BEGIN
[0m14:39:48.383051 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:39:48.393450 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:39:48.394196 [debug] [MainThread]: On master: COMMIT
[0m14:39:48.394661 [debug] [MainThread]: Using postgres connection "master"
[0m14:39:48.395073 [debug] [MainThread]: On master: COMMIT
[0m14:39:48.396024 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:39:48.397172 [debug] [MainThread]: On master: Close
[0m14:39:48.398266 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:39:48.398765 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m14:39:48.399298 [info ] [MainThread]: 
[0m14:39:48.399861 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.42 seconds (0.42s).
[0m14:39:48.400921 [debug] [MainThread]: Command end result
[0m14:39:48.427970 [info ] [MainThread]: 
[0m14:39:48.429556 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:39:48.430552 [info ] [MainThread]: 
[0m14:39:48.431482 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m14:39:48.433131 [debug] [MainThread]: Command `dbt run` succeeded at 14:39:48.432788 after 0.77 seconds
[0m14:39:48.434145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7585dce76410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7585dcd905d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7585dcf14fd0>]}
[0m14:39:48.435234 [debug] [MainThread]: Flushing usage events
[0m14:39:48.444918 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m14:52:04.647461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c1388859d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c138886190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c138886650>]}


============================== 14:52:04.660858 | 903d0800-51b0-4cec-b40a-fd4344b05ad0 ==============================
[0m14:52:04.660858 [info ] [MainThread]: Running with dbt=1.6.0
[0m14:52:04.662446 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:52:04.715730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '903d0800-51b0-4cec-b40a-fd4344b05ad0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c138896ed0>]}
[0m14:52:04.717343 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m14:52:04.718687 [debug] [MainThread]: Command `dbt deps` succeeded at 14:52:04.718404 after 0.09 seconds
[0m14:52:04.719432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c13888bd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c13cb4d7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c13c94c390>]}
[0m14:52:04.720299 [debug] [MainThread]: Flushing usage events
[0m14:52:04.727847 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m14:52:09.220504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daf30ea0ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daf313f10d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daf30ea1450>]}


============================== 14:52:09.227424 | 0524c2b6-2b63-4dd9-a08c-3b7fc07a544d ==============================
[0m14:52:09.227424 [info ] [MainThread]: Running with dbt=1.6.0
[0m14:52:09.229307 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:52:09.397259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0524c2b6-2b63-4dd9-a08c-3b7fc07a544d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daf2f72fb50>]}
[0m14:52:09.412151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0524c2b6-2b63-4dd9-a08c-3b7fc07a544d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daf30ec1550>]}
[0m14:52:09.414175 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m14:52:09.432824 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m14:52:09.460040 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:52:09.460934 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:52:09.476566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0524c2b6-2b63-4dd9-a08c-3b7fc07a544d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daf30ea0090>]}
[0m14:52:09.491043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0524c2b6-2b63-4dd9-a08c-3b7fc07a544d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daf2f76c210>]}
[0m14:52:09.492158 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m14:52:09.492907 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0524c2b6-2b63-4dd9-a08c-3b7fc07a544d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daf30e91f50>]}
[0m14:52:09.495412 [info ] [MainThread]: 
[0m14:52:09.497039 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:52:09.500463 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m14:52:09.534801 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m14:52:09.536478 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m14:52:09.538510 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:52:09.550730 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m14:52:09.554330 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m14:52:09.557717 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m14:52:09.568252 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m14:52:09.568844 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m14:52:09.569246 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:52:09.577175 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m14:52:09.578158 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m14:52:09.578979 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m14:52:09.584264 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m14:52:09.586647 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m14:52:09.587581 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m14:52:09.599394 [debug] [MainThread]: Using postgres connection "master"
[0m14:52:09.600681 [debug] [MainThread]: On master: BEGIN
[0m14:52:09.601473 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:52:09.610376 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:52:09.611370 [debug] [MainThread]: Using postgres connection "master"
[0m14:52:09.612479 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:52:09.625487 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m14:52:09.628663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0524c2b6-2b63-4dd9-a08c-3b7fc07a544d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daf30ecf910>]}
[0m14:52:09.629839 [debug] [MainThread]: On master: ROLLBACK
[0m14:52:09.631032 [debug] [MainThread]: Using postgres connection "master"
[0m14:52:09.631657 [debug] [MainThread]: On master: BEGIN
[0m14:52:09.632641 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:52:09.633088 [debug] [MainThread]: On master: COMMIT
[0m14:52:09.633463 [debug] [MainThread]: Using postgres connection "master"
[0m14:52:09.633845 [debug] [MainThread]: On master: COMMIT
[0m14:52:09.634352 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:52:09.634751 [debug] [MainThread]: On master: Close
[0m14:52:09.635757 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:52:09.636272 [info ] [MainThread]: 
[0m14:52:09.649039 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m14:52:09.650149 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m14:52:09.651577 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m14:52:09.652320 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m14:52:09.665446 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m14:52:09.666862 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 14:52:09.652754 => 14:52:09.666450
[0m14:52:09.667699 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m14:52:09.732213 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m14:52:09.733472 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:52:09.734225 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m14:52:09.734799 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:52:09.741701 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m14:52:09.742794 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:52:09.743666 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m14:52:09.751589 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.0 seconds
[0m14:52:09.764840 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:52:09.765738 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m14:52:09.768206 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:52:09.805853 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m14:52:09.806914 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:52:09.807903 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m14:52:09.810995 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m14:52:09.830060 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:52:09.831103 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m14:52:09.832739 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m14:52:09.835260 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 14:52:09.668193 => 14:52:09.834962
[0m14:52:09.835906 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m14:52:09.837212 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0524c2b6-2b63-4dd9-a08c-3b7fc07a544d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daf2f4c5810>]}
[0m14:52:09.838277 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 0[0m in 0.19s]
[0m14:52:09.839301 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m14:52:09.844957 [debug] [MainThread]: Using postgres connection "master"
[0m14:52:09.846167 [debug] [MainThread]: On master: BEGIN
[0m14:52:09.847112 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:52:09.859157 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:52:09.861027 [debug] [MainThread]: On master: COMMIT
[0m14:52:09.864468 [debug] [MainThread]: Using postgres connection "master"
[0m14:52:09.865847 [debug] [MainThread]: On master: COMMIT
[0m14:52:09.867729 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:52:09.868807 [debug] [MainThread]: On master: Close
[0m14:52:09.871194 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:52:09.872378 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m14:52:09.873537 [info ] [MainThread]: 
[0m14:52:09.874673 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.38 seconds (0.38s).
[0m14:52:09.876801 [debug] [MainThread]: Command end result
[0m14:52:09.904209 [info ] [MainThread]: 
[0m14:52:09.905749 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:52:09.906820 [info ] [MainThread]: 
[0m14:52:09.907809 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m14:52:09.909563 [debug] [MainThread]: Command `dbt run` succeeded at 14:52:09.909184 after 0.70 seconds
[0m14:52:09.910601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daf34e88590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daf34fe4190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daf34fe5090>]}
[0m14:52:09.911667 [debug] [MainThread]: Flushing usage events
[0m14:52:09.921103 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m14:55:55.565320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca3b6690a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca3b669bad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca3b6690110>]}


============================== 14:55:55.578391 | dbbcf5b8-278b-46dc-a185-7a75e33da70a ==============================
[0m14:55:55.578391 [info ] [MainThread]: Running with dbt=1.6.0
[0m14:55:55.579822 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt deps', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:55:55.620765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dbbcf5b8-278b-46dc-a185-7a75e33da70a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca3b669bb90>]}
[0m14:55:55.622337 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m14:55:55.627281 [debug] [MainThread]: Command `dbt deps` succeeded at 14:55:55.623396 after 0.07 seconds
[0m14:55:55.628929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca3ba654590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca3ba654510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca3b669bb90>]}
[0m14:55:55.629946 [debug] [MainThread]: Flushing usage events
[0m14:55:55.640032 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m14:55:58.680905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cc1735d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cc1c7d310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cc1735510>]}


============================== 14:55:58.687954 | f5cbd43f-5e0e-405c-ab5d-df21f20514f6 ==============================
[0m14:55:58.687954 [info ] [MainThread]: Running with dbt=1.6.0
[0m14:55:58.688787 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m14:55:58.786581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f5cbd43f-5e0e-405c-ab5d-df21f20514f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cc1614790>]}
[0m14:55:58.812512 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f5cbd43f-5e0e-405c-ab5d-df21f20514f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cc15637d0>]}
[0m14:55:58.815073 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m14:55:58.838306 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m14:55:58.870343 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:55:58.870956 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:55:58.898202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f5cbd43f-5e0e-405c-ab5d-df21f20514f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cc1558a90>]}
[0m14:55:58.914320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f5cbd43f-5e0e-405c-ab5d-df21f20514f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cbfe08990>]}
[0m14:55:58.915165 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m14:55:58.915703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5cbd43f-5e0e-405c-ab5d-df21f20514f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cc2091450>]}
[0m14:55:58.917747 [info ] [MainThread]: 
[0m14:55:58.918806 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:55:58.921047 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m14:55:58.937171 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m14:55:58.937773 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m14:55:58.938274 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:55:58.948453 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m14:55:58.952351 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m14:55:58.956209 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m14:55:58.973638 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m14:55:58.974881 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m14:55:58.975760 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:55:58.985556 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m14:55:58.986510 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m14:55:58.987366 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m14:55:58.992206 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m14:55:58.996286 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m14:55:58.997640 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m14:55:59.006441 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:59.007039 [debug] [MainThread]: On master: BEGIN
[0m14:55:59.007435 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:55:59.015169 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:55:59.015859 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:59.016544 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:55:59.032340 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m14:55:59.034450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5cbd43f-5e0e-405c-ab5d-df21f20514f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cc23f5c10>]}
[0m14:55:59.035177 [debug] [MainThread]: On master: ROLLBACK
[0m14:55:59.036310 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:59.037262 [debug] [MainThread]: On master: BEGIN
[0m14:55:59.038858 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:55:59.039794 [debug] [MainThread]: On master: COMMIT
[0m14:55:59.040626 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:59.041375 [debug] [MainThread]: On master: COMMIT
[0m14:55:59.042697 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:55:59.043606 [debug] [MainThread]: On master: Close
[0m14:55:59.045598 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:55:59.046560 [info ] [MainThread]: 
[0m14:55:59.064197 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m14:55:59.065230 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m14:55:59.066590 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m14:55:59.067226 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m14:55:59.077961 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m14:55:59.081184 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 14:55:59.067666 => 14:55:59.080694
[0m14:55:59.081831 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m14:55:59.131245 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m14:55:59.132247 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:55:59.132764 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m14:55:59.133205 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:55:59.140559 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m14:55:59.141503 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:55:59.142269 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m14:55:59.152403 [debug] [Thread-1 (]: SQL status: SELECT 11 in 0.0 seconds
[0m14:55:59.160730 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:55:59.161198 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution" rename to "clean_pollution__dbt_backup"
[0m14:55:59.162271 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:55:59.165944 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:55:59.166331 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m14:55:59.167249 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:55:59.190707 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m14:55:59.191493 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:55:59.191986 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m14:55:59.194807 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m14:55:59.208394 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m14:55:59.208945 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m14:55:59.213794 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m14:55:59.216037 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 14:55:59.082179 => 14:55:59.215760
[0m14:55:59.216582 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m14:55:59.217761 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5cbd43f-5e0e-405c-ab5d-df21f20514f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cc172f010>]}
[0m14:55:59.218670 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 11[0m in 0.15s]
[0m14:55:59.219518 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m14:55:59.222682 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:59.223167 [debug] [MainThread]: On master: BEGIN
[0m14:55:59.223518 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:55:59.231655 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:55:59.232546 [debug] [MainThread]: On master: COMMIT
[0m14:55:59.232934 [debug] [MainThread]: Using postgres connection "master"
[0m14:55:59.233251 [debug] [MainThread]: On master: COMMIT
[0m14:55:59.234292 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:55:59.234705 [debug] [MainThread]: On master: Close
[0m14:55:59.235793 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:55:59.236260 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m14:55:59.237083 [info ] [MainThread]: 
[0m14:55:59.237735 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.32 seconds (0.32s).
[0m14:55:59.239074 [debug] [MainThread]: Command end result
[0m14:55:59.251789 [info ] [MainThread]: 
[0m14:55:59.252652 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:55:59.253195 [info ] [MainThread]: 
[0m14:55:59.253767 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m14:55:59.254740 [debug] [MainThread]: Command `dbt run` succeeded at 14:55:59.254513 after 0.58 seconds
[0m14:55:59.255317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cc56c4490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cc5848190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cc58481d0>]}
[0m14:55:59.255888 [debug] [MainThread]: Flushing usage events
[0m14:55:59.261968 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:05:36.715028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703e7faed8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703e7faedf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703e7faee650>]}


============================== 15:05:36.729172 | e706f72c-eaeb-4fd4-83b7-477bb33b6718 ==============================
[0m15:05:36.729172 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:05:36.730402 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt deps', 'send_anonymous_usage_stats': 'True'}
[0m15:05:36.777713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e706f72c-eaeb-4fd4-83b7-477bb33b6718', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703e7f942dd0>]}
[0m15:05:36.779052 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m15:05:36.780449 [debug] [MainThread]: Command `dbt deps` succeeded at 15:05:36.780136 after 0.08 seconds
[0m15:05:36.781351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703e83aac590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703e83aac510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703e83c30e50>]}
[0m15:05:36.782181 [debug] [MainThread]: Flushing usage events
[0m15:05:36.790507 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:05:40.708818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cc12698d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cc12be0cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cc126997d0>]}


============================== 15:05:40.713888 | 3d1650e9-e34e-4c8e-9c23-25c1c6287d89 ==============================
[0m15:05:40.713888 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:05:40.715151 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:05:40.815543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3d1650e9-e34e-4c8e-9c23-25c1c6287d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cc12562190>]}
[0m15:05:40.827833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3d1650e9-e34e-4c8e-9c23-25c1c6287d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cc124c17d0>]}
[0m15:05:40.828944 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m15:05:40.841492 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m15:05:40.864073 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:05:40.864676 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:05:40.889701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3d1650e9-e34e-4c8e-9c23-25c1c6287d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cc1268f090>]}
[0m15:05:40.903179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3d1650e9-e34e-4c8e-9c23-25c1c6287d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cc10d70dd0>]}
[0m15:05:40.904217 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m15:05:40.904844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3d1650e9-e34e-4c8e-9c23-25c1c6287d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cc13eef110>]}
[0m15:05:40.907011 [info ] [MainThread]: 
[0m15:05:40.908275 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:05:40.910106 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m15:05:40.926602 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m15:05:40.927215 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m15:05:40.927603 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:05:40.939474 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:05:40.943740 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m15:05:40.947277 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m15:05:40.958446 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:05:40.959102 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m15:05:40.959437 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:05:40.968645 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:05:40.969799 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:05:40.970757 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:05:40.979563 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m15:05:40.984105 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m15:05:40.985862 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m15:05:40.996739 [debug] [MainThread]: Using postgres connection "master"
[0m15:05:40.997256 [debug] [MainThread]: On master: BEGIN
[0m15:05:40.997626 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:05:41.004076 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:05:41.004725 [debug] [MainThread]: Using postgres connection "master"
[0m15:05:41.005316 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:05:41.015611 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m15:05:41.017861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3d1650e9-e34e-4c8e-9c23-25c1c6287d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cc133558d0>]}
[0m15:05:41.018632 [debug] [MainThread]: On master: ROLLBACK
[0m15:05:41.019761 [debug] [MainThread]: Using postgres connection "master"
[0m15:05:41.020683 [debug] [MainThread]: On master: BEGIN
[0m15:05:41.022424 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:05:41.023224 [debug] [MainThread]: On master: COMMIT
[0m15:05:41.023567 [debug] [MainThread]: Using postgres connection "master"
[0m15:05:41.023863 [debug] [MainThread]: On master: COMMIT
[0m15:05:41.024336 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:05:41.024668 [debug] [MainThread]: On master: Close
[0m15:05:41.025491 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:05:41.025911 [info ] [MainThread]: 
[0m15:05:41.039643 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m15:05:41.041326 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m15:05:41.043363 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m15:05:41.044456 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m15:05:41.055193 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m15:05:41.056308 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 15:05:41.045085 => 15:05:41.055964
[0m15:05:41.056921 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m15:05:41.106778 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m15:05:41.107846 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:05:41.108320 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m15:05:41.108733 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:05:41.116064 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m15:05:41.116976 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:05:41.117667 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m15:05:41.125306 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.0 seconds
[0m15:05:41.140804 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:05:41.141468 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m15:05:41.142666 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:05:41.167704 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:05:41.168424 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:05:41.169075 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:05:41.170857 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m15:05:41.185533 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:05:41.186277 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m15:05:41.187386 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m15:05:41.190319 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 15:05:41.057254 => 15:05:41.189985
[0m15:05:41.190909 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m15:05:41.192344 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3d1650e9-e34e-4c8e-9c23-25c1c6287d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cc10dfef90>]}
[0m15:05:41.193329 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 0[0m in 0.15s]
[0m15:05:41.194195 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m15:05:41.198019 [debug] [MainThread]: Using postgres connection "master"
[0m15:05:41.198760 [debug] [MainThread]: On master: BEGIN
[0m15:05:41.199363 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:05:41.205883 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:05:41.206558 [debug] [MainThread]: On master: COMMIT
[0m15:05:41.207014 [debug] [MainThread]: Using postgres connection "master"
[0m15:05:41.207429 [debug] [MainThread]: On master: COMMIT
[0m15:05:41.208061 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:05:41.208505 [debug] [MainThread]: On master: Close
[0m15:05:41.209615 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:05:41.209994 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m15:05:41.210418 [info ] [MainThread]: 
[0m15:05:41.210877 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.30 seconds (0.30s).
[0m15:05:41.211764 [debug] [MainThread]: Command end result
[0m15:05:41.224358 [info ] [MainThread]: 
[0m15:05:41.225147 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:05:41.225640 [info ] [MainThread]: 
[0m15:05:41.226131 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:05:41.226971 [debug] [MainThread]: Command `dbt run` succeeded at 15:05:41.226782 after 0.53 seconds
[0m15:05:41.227511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cc16628490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cc16628550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cc124b73d0>]}
[0m15:05:41.228045 [debug] [MainThread]: Flushing usage events
[0m15:05:41.233475 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:08:26.924091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd799add850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd799aef4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd799addfd0>]}


============================== 15:08:26.939280 | 2d1dd5a8-22dc-44e6-9653-c6bd73a0b5fc ==============================
[0m15:08:26.939280 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:08:26.941609 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt deps', 'send_anonymous_usage_stats': 'True'}
[0m15:08:27.015638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2d1dd5a8-22dc-44e6-9653-c6bd73a0b5fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd799b24850>]}
[0m15:08:27.017222 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m15:08:27.019045 [debug] [MainThread]: Command `dbt deps` succeeded at 15:08:27.018669 after 0.11 seconds
[0m15:08:27.020029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd79dad8690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd79dad8610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd79dc34f10>]}
[0m15:08:27.021130 [debug] [MainThread]: Flushing usage events
[0m15:08:27.031306 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:08:30.963273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e0768d24e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e07697da090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e0768d25810>]}


============================== 15:08:30.971674 | fe98c0ff-030a-4a28-b7b4-90d830c3ef97 ==============================
[0m15:08:30.971674 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:08:30.973315 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:08:31.078968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fe98c0ff-030a-4a28-b7b4-90d830c3ef97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e0768d24cd0>]}
[0m15:08:31.090849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fe98c0ff-030a-4a28-b7b4-90d830c3ef97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e0768d16750>]}
[0m15:08:31.091810 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m15:08:31.104872 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m15:08:31.127746 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:08:31.128311 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:08:31.153286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fe98c0ff-030a-4a28-b7b4-90d830c3ef97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e0767469590>]}
[0m15:08:31.165867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fe98c0ff-030a-4a28-b7b4-90d830c3ef97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e07675f01d0>]}
[0m15:08:31.166667 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m15:08:31.167222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fe98c0ff-030a-4a28-b7b4-90d830c3ef97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e076bee4250>]}
[0m15:08:31.169327 [info ] [MainThread]: 
[0m15:08:31.170516 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:08:31.172262 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m15:08:31.187257 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m15:08:31.187737 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m15:08:31.188079 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:08:31.197505 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:08:31.199547 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m15:08:31.202513 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m15:08:31.215289 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:08:31.215890 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m15:08:31.216229 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:31.224878 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:08:31.225980 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:08:31.226608 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:08:31.231675 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m15:08:31.235554 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m15:08:31.236697 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m15:08:31.247061 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:31.247514 [debug] [MainThread]: On master: BEGIN
[0m15:08:31.247868 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:08:31.256122 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:08:31.257105 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:31.258156 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:08:31.273700 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m15:08:31.277578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fe98c0ff-030a-4a28-b7b4-90d830c3ef97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e07693f2290>]}
[0m15:08:31.278973 [debug] [MainThread]: On master: ROLLBACK
[0m15:08:31.280423 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:31.281347 [debug] [MainThread]: On master: BEGIN
[0m15:08:31.282890 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:08:31.283793 [debug] [MainThread]: On master: COMMIT
[0m15:08:31.284543 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:31.285235 [debug] [MainThread]: On master: COMMIT
[0m15:08:31.286503 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:08:31.287461 [debug] [MainThread]: On master: Close
[0m15:08:31.289543 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:08:31.290508 [info ] [MainThread]: 
[0m15:08:31.305822 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m15:08:31.306977 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m15:08:31.308268 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m15:08:31.308890 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m15:08:31.321084 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m15:08:31.322432 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 15:08:31.309256 => 15:08:31.322042
[0m15:08:31.323012 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m15:08:31.374049 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m15:08:31.375606 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:08:31.376151 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m15:08:31.376682 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:08:31.386029 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m15:08:31.387316 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:08:31.388264 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m15:08:31.396720 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.0 seconds
[0m15:08:31.413769 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:08:31.415230 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m15:08:31.417573 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:08:31.474714 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:08:31.476224 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:08:31.477288 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:08:31.480052 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m15:08:31.503761 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:08:31.505262 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m15:08:31.507464 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m15:08:31.512114 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 15:08:31.323362 => 15:08:31.511494
[0m15:08:31.513149 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m15:08:31.515370 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe98c0ff-030a-4a28-b7b4-90d830c3ef97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e076749d810>]}
[0m15:08:31.517192 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 0[0m in 0.21s]
[0m15:08:31.518881 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m15:08:31.523644 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:31.524662 [debug] [MainThread]: On master: BEGIN
[0m15:08:31.525222 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:08:31.530741 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:08:31.531342 [debug] [MainThread]: On master: COMMIT
[0m15:08:31.531811 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:31.532234 [debug] [MainThread]: On master: COMMIT
[0m15:08:31.532818 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:08:31.533298 [debug] [MainThread]: On master: Close
[0m15:08:31.534417 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:08:31.534810 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m15:08:31.535172 [info ] [MainThread]: 
[0m15:08:31.535517 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.37 seconds (0.37s).
[0m15:08:31.536263 [debug] [MainThread]: Command end result
[0m15:08:31.549378 [info ] [MainThread]: 
[0m15:08:31.550240 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:08:31.550758 [info ] [MainThread]: 
[0m15:08:31.551284 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:08:31.552149 [debug] [MainThread]: Command `dbt run` succeeded at 15:08:31.551961 after 0.60 seconds
[0m15:08:31.552709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e076cdca190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e076cd0c590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e076a29b190>]}
[0m15:08:31.553262 [debug] [MainThread]: Flushing usage events
[0m15:08:31.558584 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:15:03.249787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f75dfdca090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f75e1524210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f75dfdca210>]}


============================== 15:15:03.261287 | 54b3cfda-d43f-4f9a-a7a9-2d98d44e0aec ==============================
[0m15:15:03.261287 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:15:03.262024 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt deps', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:15:03.312377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '54b3cfda-d43f-4f9a-a7a9-2d98d44e0aec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f75dfdf68d0>]}
[0m15:15:03.313434 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m15:15:03.314267 [debug] [MainThread]: Command `dbt deps` succeeded at 15:15:03.314089 after 0.07 seconds
[0m15:15:03.314904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f75e0524090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f75e3f24510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f75e3f24490>]}
[0m15:15:03.315576 [debug] [MainThread]: Flushing usage events
[0m15:15:03.322745 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:15:06.301793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe75e3ad390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe75e3a2c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe75e3ad910>]}


============================== 15:15:06.306471 | defc0a9f-5fce-48fe-829a-cc2eaec1459a ==============================
[0m15:15:06.306471 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:15:06.307296 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:15:06.397146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'defc0a9f-5fce-48fe-829a-cc2eaec1459a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe75e27b390>]}
[0m15:15:06.409030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'defc0a9f-5fce-48fe-829a-cc2eaec1459a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe75e27bd10>]}
[0m15:15:06.410068 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m15:15:06.422190 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m15:15:06.444644 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:15:06.445211 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:15:06.469291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'defc0a9f-5fce-48fe-829a-cc2eaec1459a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe75e3afb10>]}
[0m15:15:06.481287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'defc0a9f-5fce-48fe-829a-cc2eaec1459a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe75ca80150>]}
[0m15:15:06.481967 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m15:15:06.482359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'defc0a9f-5fce-48fe-829a-cc2eaec1459a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe75e39db90>]}
[0m15:15:06.484158 [info ] [MainThread]: 
[0m15:15:06.485266 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:15:06.487222 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m15:15:06.501988 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m15:15:06.502515 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m15:15:06.502859 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:15:06.513058 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:15:06.517041 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m15:15:06.521350 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m15:15:06.533112 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:15:06.533707 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m15:15:06.534039 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:15:06.541337 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:15:06.541937 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:15:06.542366 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:15:06.547619 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m15:15:06.550068 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m15:15:06.550902 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m15:15:06.559469 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:06.559951 [debug] [MainThread]: On master: BEGIN
[0m15:15:06.560282 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:15:06.569586 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:15:06.570738 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:06.571756 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:15:06.582292 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m15:15:06.584645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'defc0a9f-5fce-48fe-829a-cc2eaec1459a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe75f071c10>]}
[0m15:15:06.585549 [debug] [MainThread]: On master: ROLLBACK
[0m15:15:06.586820 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:06.587432 [debug] [MainThread]: On master: BEGIN
[0m15:15:06.589107 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:15:06.590026 [debug] [MainThread]: On master: COMMIT
[0m15:15:06.590992 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:06.591435 [debug] [MainThread]: On master: COMMIT
[0m15:15:06.592138 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:15:06.592601 [debug] [MainThread]: On master: Close
[0m15:15:06.593510 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:15:06.593934 [info ] [MainThread]: 
[0m15:15:06.605975 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m15:15:06.606903 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m15:15:06.608359 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m15:15:06.608993 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m15:15:06.619338 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m15:15:06.620487 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 15:15:06.609332 => 15:15:06.620123
[0m15:15:06.621041 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m15:15:06.681336 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m15:15:06.682316 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:15:06.682723 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m15:15:06.683080 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:15:06.692079 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m15:15:06.693291 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:15:06.694472 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m15:15:06.705011 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.0 seconds
[0m15:15:06.717837 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:15:06.718507 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m15:15:06.719693 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:15:06.743788 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:15:06.744414 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:15:06.744868 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:15:06.746887 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m15:15:06.758364 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:15:06.758944 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m15:15:06.759834 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m15:15:06.761879 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 15:15:06.621345 => 15:15:06.761598
[0m15:15:06.762408 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m15:15:06.763635 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'defc0a9f-5fce-48fe-829a-cc2eaec1459a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe75e289d90>]}
[0m15:15:06.764573 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 0[0m in 0.16s]
[0m15:15:06.765388 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m15:15:06.769479 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:06.769993 [debug] [MainThread]: On master: BEGIN
[0m15:15:06.770374 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:15:06.779402 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:15:06.780402 [debug] [MainThread]: On master: COMMIT
[0m15:15:06.781195 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:06.781645 [debug] [MainThread]: On master: COMMIT
[0m15:15:06.782162 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:15:06.782503 [debug] [MainThread]: On master: Close
[0m15:15:06.783355 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:15:06.783705 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m15:15:06.784090 [info ] [MainThread]: 
[0m15:15:06.784588 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.30 seconds (0.30s).
[0m15:15:06.785420 [debug] [MainThread]: Command end result
[0m15:15:06.796917 [info ] [MainThread]: 
[0m15:15:06.797514 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:15:06.797882 [info ] [MainThread]: 
[0m15:15:06.798254 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:15:06.798934 [debug] [MainThread]: Command `dbt run` succeeded at 15:15:06.798787 after 0.51 seconds
[0m15:15:06.799337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe75e3c7d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe75e3c7f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe762350510>]}
[0m15:15:06.799758 [debug] [MainThread]: Flushing usage events
[0m15:15:06.805514 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:19:01.195344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7291b5969e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7291b5969f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7291b596a650>]}


============================== 15:19:01.205095 | 85c3ece4-6e46-40fd-b4f4-4bbd8a509d1e ==============================
[0m15:19:01.205095 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:19:01.205951 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:19:01.243230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '85c3ece4-6e46-40fd-b4f4-4bbd8a509d1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7291b596f9d0>]}
[0m15:19:01.244274 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m15:19:01.245114 [debug] [MainThread]: Command `dbt deps` succeeded at 15:19:01.244916 after 0.06 seconds
[0m15:19:01.245647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7291b5fc9ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7291b9964690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7291b9964610>]}
[0m15:19:01.246191 [debug] [MainThread]: Flushing usage events
[0m15:19:01.252065 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:19:04.883680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703f075a4f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703f0759ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703f0759b2d0>]}


============================== 15:19:04.889061 | 61daf111-a8f2-4aff-8ec7-9981bbd142f5 ==============================
[0m15:19:04.889061 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:19:04.889912 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m15:19:04.983210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '61daf111-a8f2-4aff-8ec7-9981bbd142f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703f0759b610>]}
[0m15:19:04.994899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '61daf111-a8f2-4aff-8ec7-9981bbd142f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703f07bb4650>]}
[0m15:19:04.995908 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m15:19:05.008502 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m15:19:05.030684 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:19:05.031317 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:19:05.052238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '61daf111-a8f2-4aff-8ec7-9981bbd142f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703f05d1d950>]}
[0m15:19:05.064162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '61daf111-a8f2-4aff-8ec7-9981bbd142f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703f05e70290>]}
[0m15:19:05.064899 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m15:19:05.065358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '61daf111-a8f2-4aff-8ec7-9981bbd142f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703f075cf650>]}
[0m15:19:05.067251 [info ] [MainThread]: 
[0m15:19:05.068381 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:19:05.070019 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m15:19:05.084475 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m15:19:05.085061 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m15:19:05.085447 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:19:05.096962 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:19:05.101444 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m15:19:05.105990 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m15:19:05.114732 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:19:05.115150 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m15:19:05.115449 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:19:05.123419 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:19:05.124585 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:19:05.125559 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:19:05.131656 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m15:19:05.135351 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m15:19:05.136734 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m15:19:05.145809 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:05.146285 [debug] [MainThread]: On master: BEGIN
[0m15:19:05.146646 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:19:05.153216 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:19:05.153732 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:05.154253 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:19:05.164035 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m15:19:05.166852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '61daf111-a8f2-4aff-8ec7-9981bbd142f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703f05e33b50>]}
[0m15:19:05.168190 [debug] [MainThread]: On master: ROLLBACK
[0m15:19:05.169686 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:05.170578 [debug] [MainThread]: On master: BEGIN
[0m15:19:05.171927 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:19:05.172753 [debug] [MainThread]: On master: COMMIT
[0m15:19:05.173387 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:05.173981 [debug] [MainThread]: On master: COMMIT
[0m15:19:05.174719 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:19:05.175336 [debug] [MainThread]: On master: Close
[0m15:19:05.176473 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:19:05.177010 [info ] [MainThread]: 
[0m15:19:05.190676 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m15:19:05.191881 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m15:19:05.193256 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m15:19:05.193863 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m15:19:05.204490 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m15:19:05.205729 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 15:19:05.194263 => 15:19:05.205324
[0m15:19:05.206304 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m15:19:05.258070 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m15:19:05.259099 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:19:05.259541 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m15:19:05.259912 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:05.266440 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m15:19:05.267073 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:19:05.267625 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m15:19:05.274159 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.0 seconds
[0m15:19:05.284175 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:19:05.284800 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m15:19:05.285735 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:19:05.309952 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:19:05.310591 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:19:05.310993 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:19:05.312627 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m15:19:05.324507 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:19:05.324998 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m15:19:05.325837 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m15:19:05.327730 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 15:19:05.206651 => 15:19:05.327485
[0m15:19:05.328149 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m15:19:05.329064 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '61daf111-a8f2-4aff-8ec7-9981bbd142f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703f05badb50>]}
[0m15:19:05.329867 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 0[0m in 0.14s]
[0m15:19:05.330533 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m15:19:05.334217 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:05.334672 [debug] [MainThread]: On master: BEGIN
[0m15:19:05.335012 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:19:05.343134 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:19:05.344112 [debug] [MainThread]: On master: COMMIT
[0m15:19:05.344889 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:05.345564 [debug] [MainThread]: On master: COMMIT
[0m15:19:05.346787 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:19:05.347714 [debug] [MainThread]: On master: Close
[0m15:19:05.349448 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:19:05.350202 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m15:19:05.351034 [info ] [MainThread]: 
[0m15:19:05.351881 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.28 seconds (0.28s).
[0m15:19:05.353513 [debug] [MainThread]: Command end result
[0m15:19:05.366707 [info ] [MainThread]: 
[0m15:19:05.367249 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:19:05.367623 [info ] [MainThread]: 
[0m15:19:05.367986 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:19:05.368624 [debug] [MainThread]: Command `dbt run` succeeded at 15:19:05.368474 after 0.49 seconds
[0m15:19:05.369049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703f0b58c590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703f0b6e8190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703f0b6e9090>]}
[0m15:19:05.369472 [debug] [MainThread]: Flushing usage events
[0m15:19:05.374195 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:24:10.156121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bdb5bcd710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bdb6175dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bdb5bce010>]}


============================== 15:24:10.173058 | 0ccf2e15-718a-4b10-becc-a4d4e1aadcb2 ==============================
[0m15:24:10.173058 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:24:10.174638 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:24:10.229024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0ccf2e15-718a-4b10-becc-a4d4e1aadcb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bdb7b7b010>]}
[0m15:24:10.230556 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m15:24:10.232425 [debug] [MainThread]: Command `dbt deps` succeeded at 15:24:10.232094 after 0.09 seconds
[0m15:24:10.233607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bdb9bbc610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bdb9bbc590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bdb656a010>]}
[0m15:24:10.234706 [debug] [MainThread]: Flushing usage events
[0m15:24:10.247434 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:24:14.610289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768b05275350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768b057c50d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768b05266f10>]}


============================== 15:24:14.617456 | e89fa58c-db3b-4f68-8d44-b0e4f82563b2 ==============================
[0m15:24:14.617456 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:24:14.619094 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:24:14.762511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e89fa58c-db3b-4f68-8d44-b0e4f82563b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768b05274250>]}
[0m15:24:14.783287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e89fa58c-db3b-4f68-8d44-b0e4f82563b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768b03ae7ed0>]}
[0m15:24:14.784754 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m15:24:14.806083 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m15:24:14.855031 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:24:14.856432 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:24:14.883480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e89fa58c-db3b-4f68-8d44-b0e4f82563b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768b052ac2d0>]}
[0m15:24:14.898380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e89fa58c-db3b-4f68-8d44-b0e4f82563b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768b03b40210>]}
[0m15:24:14.899470 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m15:24:14.900306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e89fa58c-db3b-4f68-8d44-b0e4f82563b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768b05265d10>]}
[0m15:24:14.902514 [info ] [MainThread]: 
[0m15:24:14.903691 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:24:14.906452 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m15:24:14.928638 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m15:24:14.929439 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m15:24:14.930052 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:24:14.946691 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:24:14.950755 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m15:24:14.954480 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m15:24:14.969689 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:24:14.971622 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m15:24:14.972930 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:24:14.982949 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:24:14.984068 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:24:14.984967 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:24:14.993598 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m15:24:14.997472 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m15:24:15.002161 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m15:24:15.014599 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:15.015689 [debug] [MainThread]: On master: BEGIN
[0m15:24:15.016559 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:24:15.025542 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:24:15.026438 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:15.027035 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:24:15.049934 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m15:24:15.053208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e89fa58c-db3b-4f68-8d44-b0e4f82563b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768b05263e10>]}
[0m15:24:15.054487 [debug] [MainThread]: On master: ROLLBACK
[0m15:24:15.055668 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:15.056425 [debug] [MainThread]: On master: BEGIN
[0m15:24:15.057753 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:24:15.058536 [debug] [MainThread]: On master: COMMIT
[0m15:24:15.059219 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:15.059873 [debug] [MainThread]: On master: COMMIT
[0m15:24:15.060982 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:24:15.062012 [debug] [MainThread]: On master: Close
[0m15:24:15.066247 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:24:15.067577 [info ] [MainThread]: 
[0m15:24:15.082923 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m15:24:15.084381 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m15:24:15.086722 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m15:24:15.087878 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m15:24:15.106883 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m15:24:15.108895 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 15:24:15.088836 => 15:24:15.108302
[0m15:24:15.109637 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m15:24:15.204082 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m15:24:15.206921 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:24:15.207759 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m15:24:15.208380 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:24:15.215181 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m15:24:15.216110 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:24:15.217094 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m15:24:15.230242 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.0 seconds
[0m15:24:15.246464 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:24:15.247657 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m15:24:15.249537 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:24:15.287155 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:24:15.288308 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:24:15.289163 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:24:15.291361 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m15:24:15.307544 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:24:15.308683 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m15:24:15.310264 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m15:24:15.314818 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 15:24:15.110004 => 15:24:15.313444
[0m15:24:15.315854 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m15:24:15.317839 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e89fa58c-db3b-4f68-8d44-b0e4f82563b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768b039e1290>]}
[0m15:24:15.324508 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 0[0m in 0.23s]
[0m15:24:15.328297 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m15:24:15.337842 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:15.338941 [debug] [MainThread]: On master: BEGIN
[0m15:24:15.339586 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:24:15.349126 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:24:15.350432 [debug] [MainThread]: On master: COMMIT
[0m15:24:15.351098 [debug] [MainThread]: Using postgres connection "master"
[0m15:24:15.351561 [debug] [MainThread]: On master: COMMIT
[0m15:24:15.352291 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:24:15.352793 [debug] [MainThread]: On master: Close
[0m15:24:15.353903 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:24:15.354322 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m15:24:15.354852 [info ] [MainThread]: 
[0m15:24:15.355356 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.45 seconds (0.45s).
[0m15:24:15.356399 [debug] [MainThread]: Command end result
[0m15:24:15.379973 [info ] [MainThread]: 
[0m15:24:15.383304 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:24:15.384546 [info ] [MainThread]: 
[0m15:24:15.385595 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:24:15.387213 [debug] [MainThread]: Command `dbt run` succeeded at 15:24:15.386840 after 0.79 seconds
[0m15:24:15.388504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768b0925c590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768b0925c650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768b067eb190>]}
[0m15:24:15.389628 [debug] [MainThread]: Flushing usage events
[0m15:24:15.399901 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:31:31.204224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a189de23d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a18a418950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a189e074d0>]}


============================== 15:31:31.215601 | 9ef043c7-80d2-44a9-a239-3f8d5bc9354c ==============================
[0m15:31:31.215601 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:31:31.216893 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt deps', 'send_anonymous_usage_stats': 'True'}
[0m15:31:31.259063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9ef043c7-80d2-44a9-a239-3f8d5bc9354c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a189e40710>]}
[0m15:31:31.260259 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m15:31:31.261182 [debug] [MainThread]: Command `dbt deps` succeeded at 15:31:31.260966 after 0.07 seconds
[0m15:31:31.261852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a189dfbd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a189e07590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a189e07bd0>]}
[0m15:31:31.262496 [debug] [MainThread]: Flushing usage events
[0m15:31:31.271439 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:31:34.777978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ccc72e6d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ccc72e74d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ccc72f1410>]}


============================== 15:31:34.782348 | 5424df71-c23f-4131-9660-f2449e9eb29a ==============================
[0m15:31:34.782348 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:31:34.783229 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:31:34.870299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5424df71-c23f-4131-9660-f2449e9eb29a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ccc730b250>]}
[0m15:31:34.882642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5424df71-c23f-4131-9660-f2449e9eb29a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ccc72f10d0>]}
[0m15:31:34.883718 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m15:31:34.895961 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m15:31:34.918194 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:31:34.919071 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:31:34.942138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5424df71-c23f-4131-9660-f2449e9eb29a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ccc7315550>]}
[0m15:31:34.954987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5424df71-c23f-4131-9660-f2449e9eb29a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ccc59c8e50>]}
[0m15:31:34.955992 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m15:31:34.956668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5424df71-c23f-4131-9660-f2449e9eb29a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ccca490490>]}
[0m15:31:34.958819 [info ] [MainThread]: 
[0m15:31:34.960092 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:31:34.962654 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m15:31:34.980058 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m15:31:34.980630 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m15:31:34.980975 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:31:34.990552 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:31:34.992809 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m15:31:34.995977 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m15:31:35.006780 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:31:35.007366 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m15:31:35.007742 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:31:35.013787 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:31:35.014450 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:31:35.014935 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:31:35.019972 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m15:31:35.022607 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m15:31:35.023409 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m15:31:35.030594 [debug] [MainThread]: Using postgres connection "master"
[0m15:31:35.031055 [debug] [MainThread]: On master: BEGIN
[0m15:31:35.031397 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:31:35.038920 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:31:35.039502 [debug] [MainThread]: Using postgres connection "master"
[0m15:31:35.040047 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:31:35.049157 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m15:31:35.050895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5424df71-c23f-4131-9660-f2449e9eb29a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ccc71bafd0>]}
[0m15:31:35.051544 [debug] [MainThread]: On master: ROLLBACK
[0m15:31:35.052131 [debug] [MainThread]: Using postgres connection "master"
[0m15:31:35.052515 [debug] [MainThread]: On master: BEGIN
[0m15:31:35.053122 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:31:35.053512 [debug] [MainThread]: On master: COMMIT
[0m15:31:35.053884 [debug] [MainThread]: Using postgres connection "master"
[0m15:31:35.054224 [debug] [MainThread]: On master: COMMIT
[0m15:31:35.054685 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:31:35.055062 [debug] [MainThread]: On master: Close
[0m15:31:35.056034 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:31:35.056475 [info ] [MainThread]: 
[0m15:31:35.067893 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m15:31:35.068639 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m15:31:35.069637 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m15:31:35.070124 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m15:31:35.079909 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m15:31:35.080971 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 15:31:35.070428 => 15:31:35.080634
[0m15:31:35.081479 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m15:31:35.130723 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m15:31:35.131746 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:31:35.132179 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m15:31:35.132606 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:31:35.141204 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m15:31:35.141878 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:31:35.142376 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m15:31:35.148540 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.0 seconds
[0m15:31:35.158785 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:31:35.159345 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m15:31:35.160352 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:31:35.183971 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:31:35.184606 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:31:35.184997 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:31:35.186787 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m15:31:35.198136 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:31:35.198642 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m15:31:35.199437 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m15:31:35.201431 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 15:31:35.081797 => 15:31:35.201177
[0m15:31:35.201930 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m15:31:35.203218 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5424df71-c23f-4131-9660-f2449e9eb29a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ccc71d0950>]}
[0m15:31:35.204318 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 0[0m in 0.13s]
[0m15:31:35.205162 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m15:31:35.208455 [debug] [MainThread]: Using postgres connection "master"
[0m15:31:35.208929 [debug] [MainThread]: On master: BEGIN
[0m15:31:35.209295 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:31:35.215454 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:31:35.215859 [debug] [MainThread]: On master: COMMIT
[0m15:31:35.216161 [debug] [MainThread]: Using postgres connection "master"
[0m15:31:35.216454 [debug] [MainThread]: On master: COMMIT
[0m15:31:35.217113 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:31:35.218036 [debug] [MainThread]: On master: Close
[0m15:31:35.219947 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:31:35.220500 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m15:31:35.221041 [info ] [MainThread]: 
[0m15:31:35.221569 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m15:31:35.222533 [debug] [MainThread]: Command end result
[0m15:31:35.235161 [info ] [MainThread]: 
[0m15:31:35.235816 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:31:35.236216 [info ] [MainThread]: 
[0m15:31:35.236622 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:31:35.237340 [debug] [MainThread]: Command `dbt run` succeeded at 15:31:35.237179 after 0.47 seconds
[0m15:31:35.237832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77cccb294510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77cccb2945d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ccc71277d0>]}
[0m15:31:35.238299 [debug] [MainThread]: Flushing usage events
[0m15:31:35.244133 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:37:44.907574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7231f728e250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7231f7b6e090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7231f78320d0>]}


============================== 15:37:44.917309 | 86890b62-b617-48ae-96bd-a6a190bbdf38 ==============================
[0m15:37:44.917309 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:37:44.918047 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:37:44.952531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '86890b62-b617-48ae-96bd-a6a190bbdf38', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7231f727ed10>]}
[0m15:37:44.953589 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m15:37:44.954416 [debug] [MainThread]: Command `dbt deps` succeeded at 15:37:44.954233 after 0.06 seconds
[0m15:37:44.954947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7231fb344290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7231fb27b050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7231fb278650>]}
[0m15:37:44.955591 [debug] [MainThread]: Flushing usage events
[0m15:37:44.963416 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:37:47.994024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7610c834d6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7610c8894cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7610c834d910>]}


============================== 15:37:47.998818 | 5b399146-590c-46fb-b098-94a974468648 ==============================
[0m15:37:47.998818 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:37:47.999587 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m15:37:48.089087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5b399146-590c-46fb-b098-94a974468648', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7610c9c42190>]}
[0m15:37:48.101146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5b399146-590c-46fb-b098-94a974468648', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7610c821be90>]}
[0m15:37:48.102252 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m15:37:48.115023 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m15:37:48.137749 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:37:48.138314 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:37:48.159138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5b399146-590c-46fb-b098-94a974468648', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7610c6a99550>]}
[0m15:37:48.169712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5b399146-590c-46fb-b098-94a974468648', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7610c6a20110>]}
[0m15:37:48.170270 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m15:37:48.170654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5b399146-590c-46fb-b098-94a974468648', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7610cb4d8190>]}
[0m15:37:48.172319 [info ] [MainThread]: 
[0m15:37:48.173372 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:37:48.175699 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m15:37:48.197006 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m15:37:48.197460 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m15:37:48.197791 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:37:48.206177 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:37:48.208012 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m15:37:48.210806 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m15:37:48.219944 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:37:48.220324 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m15:37:48.220638 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:37:48.226075 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:37:48.226455 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:37:48.226856 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:37:48.230883 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m15:37:48.232583 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m15:37:48.233291 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m15:37:48.241360 [debug] [MainThread]: Using postgres connection "master"
[0m15:37:48.241869 [debug] [MainThread]: On master: BEGIN
[0m15:37:48.242199 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:37:48.247382 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:37:48.247844 [debug] [MainThread]: Using postgres connection "master"
[0m15:37:48.248303 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:37:48.257783 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m15:37:48.259364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5b399146-590c-46fb-b098-94a974468648', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7610c6a41750>]}
[0m15:37:48.259984 [debug] [MainThread]: On master: ROLLBACK
[0m15:37:48.260603 [debug] [MainThread]: Using postgres connection "master"
[0m15:37:48.260963 [debug] [MainThread]: On master: BEGIN
[0m15:37:48.261620 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:37:48.261994 [debug] [MainThread]: On master: COMMIT
[0m15:37:48.262322 [debug] [MainThread]: Using postgres connection "master"
[0m15:37:48.262645 [debug] [MainThread]: On master: COMMIT
[0m15:37:48.263326 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:37:48.263803 [debug] [MainThread]: On master: Close
[0m15:37:48.264768 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:37:48.265163 [info ] [MainThread]: 
[0m15:37:48.276043 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m15:37:48.277291 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m15:37:48.278190 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m15:37:48.278649 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m15:37:48.287694 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m15:37:48.288812 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 15:37:48.278916 => 15:37:48.288384
[0m15:37:48.289334 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m15:37:48.335992 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m15:37:48.336932 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:37:48.337330 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m15:37:48.337690 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:37:48.345270 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m15:37:48.345852 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:37:48.346299 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m15:37:48.353407 [debug] [Thread-1 (]: SQL status: SELECT 11 in 0.0 seconds
[0m15:37:48.362656 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:37:48.363271 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution" rename to "clean_pollution__dbt_backup"
[0m15:37:48.364266 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:37:48.368406 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:37:48.368891 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m15:37:48.369670 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:37:48.394936 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:37:48.395527 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:37:48.395900 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:37:48.397806 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m15:37:48.408836 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:37:48.409323 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m15:37:48.412164 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m15:37:48.414176 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 15:37:48.289636 => 15:37:48.413927
[0m15:37:48.414633 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m15:37:48.415681 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5b399146-590c-46fb-b098-94a974468648', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7610c69b1850>]}
[0m15:37:48.416478 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 11[0m in 0.14s]
[0m15:37:48.417192 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m15:37:48.420213 [debug] [MainThread]: Using postgres connection "master"
[0m15:37:48.420677 [debug] [MainThread]: On master: BEGIN
[0m15:37:48.421069 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:37:48.426719 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:37:48.427255 [debug] [MainThread]: On master: COMMIT
[0m15:37:48.427672 [debug] [MainThread]: Using postgres connection "master"
[0m15:37:48.428044 [debug] [MainThread]: On master: COMMIT
[0m15:37:48.428508 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:37:48.428881 [debug] [MainThread]: On master: Close
[0m15:37:48.429703 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:37:48.430059 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m15:37:48.430422 [info ] [MainThread]: 
[0m15:37:48.430795 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m15:37:48.431510 [debug] [MainThread]: Command end result
[0m15:37:48.442596 [info ] [MainThread]: 
[0m15:37:48.443119 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:37:48.443444 [info ] [MainThread]: 
[0m15:37:48.443805 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:37:48.444403 [debug] [MainThread]: Command `dbt run` succeeded at 15:37:48.444271 after 0.46 seconds
[0m15:37:48.444865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7610cc2dc550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7610cc460190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7610cc461090>]}
[0m15:37:48.445338 [debug] [MainThread]: Flushing usage events
[0m15:37:48.450249 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:43:04.885421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2ac5438e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2ac4e87750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2ac4cdce10>]}


============================== 15:43:04.897679 | 66d80d14-5c22-4a57-a7dc-4cc1976f2537 ==============================
[0m15:43:04.897679 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:43:04.898860 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:43:04.954601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '66d80d14-5c22-4a57-a7dc-4cc1976f2537', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2ac4ccff90>]}
[0m15:43:04.956563 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m15:43:04.958352 [debug] [MainThread]: Command `dbt deps` succeeded at 15:43:04.957994 after 0.09 seconds
[0m15:43:04.959383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2ac8fbc190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2ac8fbc990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2ac8fbd010>]}
[0m15:43:04.960513 [debug] [MainThread]: Flushing usage events
[0m15:43:04.971065 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:43:09.709583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f6f2451150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f6f29a1450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f6f2451610>]}


============================== 15:43:09.714912 | 6fefa5c4-5375-46bf-963d-ab4e71f188b0 ==============================
[0m15:43:09.714912 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:43:09.715788 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:43:09.861767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6fefa5c4-5375-46bf-963d-ab4e71f188b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f6f2467790>]}
[0m15:43:09.874781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6fefa5c4-5375-46bf-963d-ab4e71f188b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f6f244af90>]}
[0m15:43:09.876152 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m15:43:09.890446 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m15:43:09.915365 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:43:09.915971 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:43:09.939082 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6fefa5c4-5375-46bf-963d-ab4e71f188b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f6f0b95590>]}
[0m15:43:09.953399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6fefa5c4-5375-46bf-963d-ab4e71f188b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f6f0d1ca10>]}
[0m15:43:09.954368 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m15:43:09.954971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6fefa5c4-5375-46bf-963d-ab4e71f188b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f6f5610250>]}
[0m15:43:09.957748 [info ] [MainThread]: 
[0m15:43:09.959436 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:43:09.961582 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m15:43:09.977116 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m15:43:09.978013 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m15:43:09.978506 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:43:09.991984 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:43:09.994540 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m15:43:10.000956 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m15:43:10.013927 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:43:10.014550 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m15:43:10.015055 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:43:10.024093 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:43:10.025551 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:43:10.026609 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:43:10.033110 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m15:43:10.037342 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m15:43:10.039049 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m15:43:10.052755 [debug] [MainThread]: Using postgres connection "master"
[0m15:43:10.053440 [debug] [MainThread]: On master: BEGIN
[0m15:43:10.053857 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:43:10.060943 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:43:10.062129 [debug] [MainThread]: Using postgres connection "master"
[0m15:43:10.063155 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:43:10.073677 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m15:43:10.076998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6fefa5c4-5375-46bf-963d-ab4e71f188b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f6f3315b50>]}
[0m15:43:10.077972 [debug] [MainThread]: On master: ROLLBACK
[0m15:43:10.079110 [debug] [MainThread]: Using postgres connection "master"
[0m15:43:10.080093 [debug] [MainThread]: On master: BEGIN
[0m15:43:10.081438 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:43:10.082110 [debug] [MainThread]: On master: COMMIT
[0m15:43:10.082695 [debug] [MainThread]: Using postgres connection "master"
[0m15:43:10.083260 [debug] [MainThread]: On master: COMMIT
[0m15:43:10.084319 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:43:10.084871 [debug] [MainThread]: On master: Close
[0m15:43:10.085917 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:43:10.086403 [info ] [MainThread]: 
[0m15:43:10.108406 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m15:43:10.109884 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m15:43:10.111564 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m15:43:10.112358 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m15:43:10.127194 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m15:43:10.129696 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 15:43:10.112835 => 15:43:10.128831
[0m15:43:10.130562 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m15:43:10.223902 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m15:43:10.226301 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:43:10.227495 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m15:43:10.228432 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:43:10.238400 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m15:43:10.239378 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:43:10.239938 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m15:43:10.247231 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.0 seconds
[0m15:43:10.258685 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:43:10.259371 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m15:43:10.260705 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:43:10.293538 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:43:10.294432 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:43:10.294982 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:43:10.297239 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m15:43:10.320938 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:43:10.321676 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m15:43:10.323415 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m15:43:10.328274 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 15:43:10.130919 => 15:43:10.327714
[0m15:43:10.329060 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m15:43:10.330511 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fefa5c4-5375-46bf-963d-ab4e71f188b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f6f0d0c410>]}
[0m15:43:10.331587 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 0[0m in 0.22s]
[0m15:43:10.332531 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m15:43:10.336498 [debug] [MainThread]: Using postgres connection "master"
[0m15:43:10.336915 [debug] [MainThread]: On master: BEGIN
[0m15:43:10.337258 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:43:10.344701 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:43:10.345425 [debug] [MainThread]: On master: COMMIT
[0m15:43:10.345916 [debug] [MainThread]: Using postgres connection "master"
[0m15:43:10.346358 [debug] [MainThread]: On master: COMMIT
[0m15:43:10.346994 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:43:10.347437 [debug] [MainThread]: On master: Close
[0m15:43:10.348732 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:43:10.349690 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m15:43:10.350362 [info ] [MainThread]: 
[0m15:43:10.351368 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.39 seconds (0.39s).
[0m15:43:10.353214 [debug] [MainThread]: Command end result
[0m15:43:10.368782 [info ] [MainThread]: 
[0m15:43:10.369654 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:43:10.370113 [info ] [MainThread]: 
[0m15:43:10.370629 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:43:10.371694 [debug] [MainThread]: Command `dbt run` succeeded at 15:43:10.371425 after 0.67 seconds
[0m15:43:10.372326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f6f6438590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f6f243ffd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f6f243fed0>]}
[0m15:43:10.372986 [debug] [MainThread]: Flushing usage events
[0m15:43:10.380498 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:54:58.176276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e27d4ec5810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e27d4ec5e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e27d4ec6550>]}


============================== 15:54:58.191205 | 38266c36-fe23-46be-b9e4-a3b4e133c591 ==============================
[0m15:54:58.191205 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:54:58.192946 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt deps', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:54:58.245588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '38266c36-fe23-46be-b9e4-a3b4e133c591', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e27d4ecba10>]}
[0m15:54:58.247115 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m15:54:58.248683 [debug] [MainThread]: Command `dbt deps` succeeded at 15:54:58.248304 after 0.08 seconds
[0m15:54:58.249739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e27d637fb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e27d8e84590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e27d8e84510>]}
[0m15:54:58.250595 [debug] [MainThread]: Flushing usage events
[0m15:54:58.260029 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:55:02.380093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7175e7a18450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7175e7a0f150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7175e7a0edd0>]}


============================== 15:55:02.386047 | f26ac839-921b-4c26-ac3f-57794b32a78a ==============================
[0m15:55:02.386047 [info ] [MainThread]: Running with dbt=1.6.0
[0m15:55:02.386987 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:55:02.511902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f26ac839-921b-4c26-ac3f-57794b32a78a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7175e7a3b350>]}
[0m15:55:02.524726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f26ac839-921b-4c26-ac3f-57794b32a78a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7175e92fa950>]}
[0m15:55:02.525960 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m15:55:02.539912 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m15:55:02.564116 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:55:02.564770 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:55:02.583002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f26ac839-921b-4c26-ac3f-57794b32a78a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7175e61996d0>]}
[0m15:55:02.598144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f26ac839-921b-4c26-ac3f-57794b32a78a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7175e60f0890>]}
[0m15:55:02.599311 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m15:55:02.600004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f26ac839-921b-4c26-ac3f-57794b32a78a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7175e7a0b350>]}
[0m15:55:02.602627 [info ] [MainThread]: 
[0m15:55:02.604223 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:55:02.606491 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m15:55:02.622720 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m15:55:02.623365 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m15:55:02.623795 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:55:02.637602 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m15:55:02.642059 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m15:55:02.646207 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m15:55:02.655794 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:55:02.656327 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m15:55:02.656653 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:55:02.663361 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m15:55:02.664012 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m15:55:02.664484 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:55:02.669184 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m15:55:02.671646 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m15:55:02.672298 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m15:55:02.685871 [debug] [MainThread]: Using postgres connection "master"
[0m15:55:02.686892 [debug] [MainThread]: On master: BEGIN
[0m15:55:02.687676 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:55:02.695325 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:55:02.695797 [debug] [MainThread]: Using postgres connection "master"
[0m15:55:02.696288 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:55:02.705832 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m15:55:02.708004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f26ac839-921b-4c26-ac3f-57794b32a78a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7175e8f8b510>]}
[0m15:55:02.708835 [debug] [MainThread]: On master: ROLLBACK
[0m15:55:02.709608 [debug] [MainThread]: Using postgres connection "master"
[0m15:55:02.710037 [debug] [MainThread]: On master: BEGIN
[0m15:55:02.710735 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:55:02.711168 [debug] [MainThread]: On master: COMMIT
[0m15:55:02.711608 [debug] [MainThread]: Using postgres connection "master"
[0m15:55:02.712002 [debug] [MainThread]: On master: COMMIT
[0m15:55:02.712881 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:55:02.713943 [debug] [MainThread]: On master: Close
[0m15:55:02.715268 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:55:02.715712 [info ] [MainThread]: 
[0m15:55:02.734436 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m15:55:02.736185 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m15:55:02.738150 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m15:55:02.738869 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m15:55:02.748882 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m15:55:02.749999 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 15:55:02.739188 => 15:55:02.749607
[0m15:55:02.750538 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m15:55:02.838758 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m15:55:02.839976 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:55:02.840499 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m15:55:02.840948 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:55:02.847887 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m15:55:02.848691 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:55:02.849308 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m15:55:02.856674 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.0 seconds
[0m15:55:02.867419 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:55:02.868091 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m15:55:02.869167 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m15:55:02.894416 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:55:02.895115 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:55:02.895530 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m15:55:02.897499 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m15:55:02.923595 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m15:55:02.925129 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m15:55:02.927250 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m15:55:02.929984 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 15:55:02.750871 => 15:55:02.929671
[0m15:55:02.930564 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m15:55:02.931821 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f26ac839-921b-4c26-ac3f-57794b32a78a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7175e791a210>]}
[0m15:55:02.932788 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 0[0m in 0.19s]
[0m15:55:02.933692 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m15:55:02.937465 [debug] [MainThread]: Using postgres connection "master"
[0m15:55:02.937952 [debug] [MainThread]: On master: BEGIN
[0m15:55:02.938320 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:55:02.946593 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m15:55:02.947851 [debug] [MainThread]: On master: COMMIT
[0m15:55:02.948797 [debug] [MainThread]: Using postgres connection "master"
[0m15:55:02.949585 [debug] [MainThread]: On master: COMMIT
[0m15:55:02.950822 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m15:55:02.951873 [debug] [MainThread]: On master: Close
[0m15:55:02.953903 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:55:02.954731 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m15:55:02.955628 [info ] [MainThread]: 
[0m15:55:02.956498 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.35 seconds (0.35s).
[0m15:55:02.958564 [debug] [MainThread]: Command end result
[0m15:55:02.984170 [info ] [MainThread]: 
[0m15:55:02.985466 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:55:02.986298 [info ] [MainThread]: 
[0m15:55:02.987176 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:55:02.988804 [debug] [MainThread]: Command `dbt run` succeeded at 15:55:02.988440 after 0.62 seconds
[0m15:55:02.989749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7175eb9bc510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7175eb9bc5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7175e837b350>]}
[0m15:55:02.990869 [debug] [MainThread]: Flushing usage events
[0m15:55:02.996957 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m17:17:21.845911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2d3b23e0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2d3b3eb750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2d3b24ffd0>]}


============================== 17:17:21.920829 | b75746d4-15e1-4b12-9a1c-ed411e328df4 ==============================
[0m17:17:21.920829 [info ] [MainThread]: Running with dbt=1.6.0
[0m17:17:21.938977 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt deps', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:17:22.412845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b75746d4-15e1-4b12-9a1c-ed411e328df4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2d3b2777d0>]}
[0m17:17:22.459409 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m17:17:22.479392 [debug] [MainThread]: Command `dbt deps` succeeded at 17:17:22.478163 after 1.50 seconds
[0m17:17:22.486392 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2d3b99ce50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2d3f490350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2d3f39c550>]}
[0m17:17:22.497941 [debug] [MainThread]: Flushing usage events
[0m17:17:44.182827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3cf929810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3d1225950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3d029e110>]}


============================== 17:17:44.236455 | 623af354-7165-4e37-bcb1-afd6fa84b427 ==============================
[0m17:17:44.236455 [info ] [MainThread]: Running with dbt=1.6.0
[0m17:17:44.240435 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:17:46.362235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '623af354-7165-4e37-bcb1-afd6fa84b427', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3cf817490>]}
[0m17:17:46.592758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '623af354-7165-4e37-bcb1-afd6fa84b427', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3cf94b210>]}
[0m17:17:46.644538 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m17:17:46.958994 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m17:17:52.142463 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:17:52.268998 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:17:52.619889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '623af354-7165-4e37-bcb1-afd6fa84b427', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3cf7fbd50>]}
[0m17:17:55.610126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '623af354-7165-4e37-bcb1-afd6fa84b427', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3cdffc210>]}
[0m17:17:55.655961 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m17:17:55.703651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '623af354-7165-4e37-bcb1-afd6fa84b427', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3cf917c90>]}
[0m17:17:55.831838 [info ] [MainThread]: 
[0m17:17:55.895498 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:17:55.998237 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m17:17:56.415568 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m17:17:56.428303 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m17:17:56.443581 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:17:56.803042 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m17:17:56.862897 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m17:17:56.930621 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m17:17:57.073023 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m17:17:57.108106 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m17:17:57.169456 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:17:57.281867 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m17:17:57.313700 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m17:17:57.363107 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m17:17:57.514617 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m17:17:57.525957 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m17:17:57.542000 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m17:17:57.631888 [debug] [MainThread]: Using postgres connection "master"
[0m17:17:57.671129 [debug] [MainThread]: On master: BEGIN
[0m17:17:57.715401 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:17:57.751995 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m17:17:57.831384 [debug] [MainThread]: Using postgres connection "master"
[0m17:17:57.842196 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:17:58.361917 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m17:17:58.396239 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '623af354-7165-4e37-bcb1-afd6fa84b427', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3cf94ad10>]}
[0m17:17:58.433733 [debug] [MainThread]: On master: ROLLBACK
[0m17:17:58.530785 [debug] [MainThread]: Using postgres connection "master"
[0m17:17:58.584345 [debug] [MainThread]: On master: BEGIN
[0m17:17:58.610907 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m17:17:58.655467 [debug] [MainThread]: On master: COMMIT
[0m17:17:58.688366 [debug] [MainThread]: Using postgres connection "master"
[0m17:17:58.709113 [debug] [MainThread]: On master: COMMIT
[0m17:17:58.740392 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m17:17:58.763504 [debug] [MainThread]: On master: Close
[0m17:17:58.792232 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:17:58.794281 [info ] [MainThread]: 
[0m17:17:59.030355 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m17:17:59.033191 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m17:17:59.114522 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m17:17:59.135378 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m17:17:59.307317 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m17:17:59.726487 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 17:17:59.138339 => 17:17:59.725673
[0m17:17:59.830148 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m17:18:00.523048 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m17:18:00.741000 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:18:00.774042 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m17:18:00.805741 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:18:00.879571 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m17:18:00.896138 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:18:00.899646 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m17:18:01.418700 [debug] [Thread-1 (]: SQL status: SELECT 363 in 0.0 seconds
[0m17:18:01.542762 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:18:01.549965 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution" rename to "clean_pollution__dbt_backup"
[0m17:18:01.563924 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:18:01.596532 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:18:01.618779 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m17:18:01.638060 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:18:01.916589 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m17:18:02.006685 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:18:02.052479 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m17:18:02.204217 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m17:18:02.523150 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:18:02.584921 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m17:18:02.658420 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m17:18:02.698192 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 17:17:59.880684 => 17:18:02.691299
[0m17:18:02.711784 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m17:18:02.765770 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '623af354-7165-4e37-bcb1-afd6fa84b427', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3cf826550>]}
[0m17:18:02.796436 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 363[0m in 3.68s]
[0m17:18:02.825379 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m17:18:02.973952 [debug] [MainThread]: Using postgres connection "master"
[0m17:18:02.989616 [debug] [MainThread]: On master: BEGIN
[0m17:18:02.992830 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:18:03.088627 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m17:18:03.100741 [debug] [MainThread]: On master: COMMIT
[0m17:18:03.106417 [debug] [MainThread]: Using postgres connection "master"
[0m17:18:03.118566 [debug] [MainThread]: On master: COMMIT
[0m17:18:03.146063 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m17:18:03.152885 [debug] [MainThread]: On master: Close
[0m17:18:03.175013 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:18:03.191517 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m17:18:03.201057 [info ] [MainThread]: 
[0m17:18:03.218389 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 7.32 seconds (7.32s).
[0m17:18:03.224369 [debug] [MainThread]: Command end result
[0m17:18:03.425884 [info ] [MainThread]: 
[0m17:18:03.443406 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:18:03.452355 [info ] [MainThread]: 
[0m17:18:03.481173 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m17:18:03.502230 [debug] [MainThread]: Command `dbt run` succeeded at 17:18:03.501265 after 19.73 seconds
[0m17:18:03.522655 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3d1226190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3d38cc510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3cfd44750>]}
[0m17:18:03.536582 [debug] [MainThread]: Flushing usage events
[0m17:53:09.176173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3c54329d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3c544dbf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3c5433bfd0>]}


============================== 17:53:09.187282 | ae6646ef-b9a9-4536-bc92-e2f8efc8ac6d ==============================
[0m17:53:09.187282 [info ] [MainThread]: Running with dbt=1.6.0
[0m17:53:09.188029 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt deps', 'send_anonymous_usage_stats': 'True'}
[0m17:53:09.221602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ae6646ef-b9a9-4536-bc92-e2f8efc8ac6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3c54340790>]}
[0m17:53:09.222623 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m17:53:09.223399 [debug] [MainThread]: Command `dbt deps` succeeded at 17:53:09.223222 after 0.06 seconds
[0m17:53:09.223903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3c58488510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3c58488490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3c5860ce90>]}
[0m17:53:09.224374 [debug] [MainThread]: Flushing usage events
[0m17:53:09.231437 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m17:53:12.268854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7877d6e75790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7877d6e75410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7877d6e75e10>]}


============================== 17:53:12.274153 | e0cd346a-ac28-4bfc-b324-698de699bae4 ==============================
[0m17:53:12.274153 [info ] [MainThread]: Running with dbt=1.6.0
[0m17:53:12.274962 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m17:53:12.365119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e0cd346a-ac28-4bfc-b324-698de699bae4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7877d6e74c50>]}
[0m17:53:12.377031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e0cd346a-ac28-4bfc-b324-698de699bae4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7877d6d3f550>]}
[0m17:53:12.377973 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m17:53:12.390328 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m17:53:12.412907 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:53:12.413430 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:53:12.426903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e0cd346a-ac28-4bfc-b324-698de699bae4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7877d55be090>]}
[0m17:53:12.437560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e0cd346a-ac28-4bfc-b324-698de699bae4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7877d55486d0>]}
[0m17:53:12.438201 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m17:53:12.438618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0cd346a-ac28-4bfc-b324-698de699bae4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7877d6e65990>]}
[0m17:53:12.440409 [info ] [MainThread]: 
[0m17:53:12.441583 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:53:12.443819 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m17:53:12.458089 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m17:53:12.458575 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m17:53:12.458901 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:53:12.471213 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m17:53:12.473066 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m17:53:12.476112 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m17:53:12.484592 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m17:53:12.485052 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m17:53:12.485371 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:53:12.494464 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m17:53:12.495024 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m17:53:12.495386 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m17:53:12.500411 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m17:53:12.503464 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m17:53:12.504268 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m17:53:12.512730 [debug] [MainThread]: Using postgres connection "master"
[0m17:53:12.513246 [debug] [MainThread]: On master: BEGIN
[0m17:53:12.513656 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:53:12.522059 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m17:53:12.523152 [debug] [MainThread]: Using postgres connection "master"
[0m17:53:12.524140 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:53:12.545800 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m17:53:12.549647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0cd346a-ac28-4bfc-b324-698de699bae4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7877d6cfb450>]}
[0m17:53:12.551084 [debug] [MainThread]: On master: ROLLBACK
[0m17:53:12.552663 [debug] [MainThread]: Using postgres connection "master"
[0m17:53:12.553583 [debug] [MainThread]: On master: BEGIN
[0m17:53:12.555308 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m17:53:12.555763 [debug] [MainThread]: On master: COMMIT
[0m17:53:12.556081 [debug] [MainThread]: Using postgres connection "master"
[0m17:53:12.556369 [debug] [MainThread]: On master: COMMIT
[0m17:53:12.557030 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m17:53:12.557454 [debug] [MainThread]: On master: Close
[0m17:53:12.558420 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:53:12.558860 [info ] [MainThread]: 
[0m17:53:12.571653 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m17:53:12.572706 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m17:53:12.573993 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m17:53:12.574677 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m17:53:12.585796 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m17:53:12.586996 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 17:53:12.575035 => 17:53:12.586639
[0m17:53:12.587534 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m17:53:12.639773 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m17:53:12.640836 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:53:12.641277 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m17:53:12.641634 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:53:12.647750 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m17:53:12.648301 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:53:12.648765 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m17:53:12.655409 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.0 seconds
[0m17:53:12.664600 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:53:12.665148 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m17:53:12.666110 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:53:12.689554 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m17:53:12.690174 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:53:12.690540 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m17:53:12.692620 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m17:53:12.704718 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:53:12.705288 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m17:53:12.706341 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m17:53:12.708419 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 17:53:12.587848 => 17:53:12.708166
[0m17:53:12.708895 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m17:53:12.710002 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0cd346a-ac28-4bfc-b324-698de699bae4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7877d54e3210>]}
[0m17:53:12.710895 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 0[0m in 0.14s]
[0m17:53:12.711719 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m17:53:12.716924 [debug] [MainThread]: Using postgres connection "master"
[0m17:53:12.717456 [debug] [MainThread]: On master: BEGIN
[0m17:53:12.717846 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:53:12.726717 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m17:53:12.727851 [debug] [MainThread]: On master: COMMIT
[0m17:53:12.728648 [debug] [MainThread]: Using postgres connection "master"
[0m17:53:12.729342 [debug] [MainThread]: On master: COMMIT
[0m17:53:12.730598 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m17:53:12.731561 [debug] [MainThread]: On master: Close
[0m17:53:12.733233 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:53:12.733715 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m17:53:12.734182 [info ] [MainThread]: 
[0m17:53:12.734599 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.29 seconds (0.29s).
[0m17:53:12.735392 [debug] [MainThread]: Command end result
[0m17:53:12.747210 [info ] [MainThread]: 
[0m17:53:12.747793 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:53:12.748188 [info ] [MainThread]: 
[0m17:53:12.748604 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m17:53:12.749334 [debug] [MainThread]: Command `dbt run` succeeded at 17:53:12.749170 after 0.49 seconds
[0m17:53:12.749830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7877dae18510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7877daf9c150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7877daf9d050>]}
[0m17:53:12.750310 [debug] [MainThread]: Flushing usage events
[0m17:53:12.756085 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m17:55:44.899151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8f330e6050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8f3310bf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8f36cf0750>]}


============================== 17:55:44.918813 | d283d95d-16df-47ac-bfd1-ffd79f1c7135 ==============================
[0m17:55:44.918813 [info ] [MainThread]: Running with dbt=1.6.0
[0m17:55:44.919780 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt deps', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m17:55:44.960712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd283d95d-16df-47ac-bfd1-ffd79f1c7135', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8f32f3e610>]}
[0m17:55:44.961870 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m17:55:44.962723 [debug] [MainThread]: Command `dbt deps` succeeded at 17:55:44.962538 after 0.07 seconds
[0m17:55:44.963219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8f330ebc50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8f344b2810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8f370a8510>]}
[0m17:55:44.963718 [debug] [MainThread]: Flushing usage events
[0m17:55:44.969995 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m17:55:48.480448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6efb768d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6efb769710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6efb769910>]}


============================== 17:55:48.488485 | 0ab667fd-21e8-49d6-9234-542eecb12515 ==============================
[0m17:55:48.488485 [info ] [MainThread]: Running with dbt=1.6.0
[0m17:55:48.489482 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:55:48.579644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0ab667fd-21e8-49d6-9234-542eecb12515', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6efb63bbd0>]}
[0m17:55:48.591446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0ab667fd-21e8-49d6-9234-542eecb12515', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6efccdaf90>]}
[0m17:55:48.592378 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m17:55:48.602696 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m17:55:48.623826 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:55:48.624327 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:55:48.645273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0ab667fd-21e8-49d6-9234-542eecb12515', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6efb635590>]}
[0m17:55:48.656083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0ab667fd-21e8-49d6-9234-542eecb12515', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6ef9e40510>]}
[0m17:55:48.656655 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m17:55:48.657051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0ab667fd-21e8-49d6-9234-542eecb12515', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6efe908490>]}
[0m17:55:48.658764 [info ] [MainThread]: 
[0m17:55:48.659851 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:55:48.662046 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m17:55:48.675895 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m17:55:48.676300 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m17:55:48.676622 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:55:48.685438 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m17:55:48.687266 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m17:55:48.689656 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m17:55:48.697459 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m17:55:48.697845 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m17:55:48.698136 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:55:48.705750 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m17:55:48.706653 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m17:55:48.707445 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m17:55:48.714835 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m17:55:48.716468 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m17:55:48.717064 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m17:55:48.723559 [debug] [MainThread]: Using postgres connection "master"
[0m17:55:48.724038 [debug] [MainThread]: On master: BEGIN
[0m17:55:48.724378 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:55:48.732231 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m17:55:48.733244 [debug] [MainThread]: Using postgres connection "master"
[0m17:55:48.733799 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:55:48.743023 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m17:55:48.744533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0ab667fd-21e8-49d6-9234-542eecb12515', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6efb598890>]}
[0m17:55:48.745097 [debug] [MainThread]: On master: ROLLBACK
[0m17:55:48.746178 [debug] [MainThread]: Using postgres connection "master"
[0m17:55:48.747108 [debug] [MainThread]: On master: BEGIN
[0m17:55:48.748579 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m17:55:48.749546 [debug] [MainThread]: On master: COMMIT
[0m17:55:48.750274 [debug] [MainThread]: Using postgres connection "master"
[0m17:55:48.751013 [debug] [MainThread]: On master: COMMIT
[0m17:55:48.751871 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m17:55:48.752358 [debug] [MainThread]: On master: Close
[0m17:55:48.753271 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:55:48.753686 [info ] [MainThread]: 
[0m17:55:48.765266 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m17:55:48.766744 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m17:55:48.768596 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m17:55:48.769679 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m17:55:48.783220 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m17:55:48.784260 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 17:55:48.770286 => 17:55:48.783928
[0m17:55:48.784785 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m17:55:48.831610 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m17:55:48.832577 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:55:48.832978 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m17:55:48.833333 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:55:48.841585 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m17:55:48.842065 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:55:48.842472 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m17:55:48.848980 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.0 seconds
[0m17:55:48.857525 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:55:48.857994 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m17:55:48.858964 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:55:48.880742 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m17:55:48.881199 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:55:48.881562 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m17:55:48.883398 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m17:55:48.893377 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:55:48.893829 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m17:55:48.894603 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m17:55:48.896352 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 17:55:48.785118 => 17:55:48.896118
[0m17:55:48.896800 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m17:55:48.897812 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ab667fd-21e8-49d6-9234-542eecb12515', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6efb75f6d0>]}
[0m17:55:48.898557 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 0[0m in 0.13s]
[0m17:55:48.899258 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m17:55:48.902543 [debug] [MainThread]: Using postgres connection "master"
[0m17:55:48.903008 [debug] [MainThread]: On master: BEGIN
[0m17:55:48.903370 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:55:48.910077 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m17:55:48.910479 [debug] [MainThread]: On master: COMMIT
[0m17:55:48.910796 [debug] [MainThread]: Using postgres connection "master"
[0m17:55:48.911082 [debug] [MainThread]: On master: COMMIT
[0m17:55:48.911533 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m17:55:48.911893 [debug] [MainThread]: On master: Close
[0m17:55:48.912861 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:55:48.913321 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m17:55:48.913794 [info ] [MainThread]: 
[0m17:55:48.914280 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.25 seconds (0.25s).
[0m17:55:48.915124 [debug] [MainThread]: Command end result
[0m17:55:48.928089 [info ] [MainThread]: 
[0m17:55:48.929068 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:55:48.929414 [info ] [MainThread]: 
[0m17:55:48.929754 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m17:55:48.930341 [debug] [MainThread]: Command `dbt run` succeeded at 17:55:48.930215 after 0.46 seconds
[0m17:55:48.930746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6eff70c510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6eff890150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6eff891050>]}
[0m17:55:48.931171 [debug] [MainThread]: Flushing usage events
[0m17:55:48.936491 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m17:57:10.478885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79eb40ca4710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79eb40ca4750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79eb40ca4d50>]}


============================== 17:57:10.486031 | cb9b4227-ea19-46b5-9a2a-4fdb76b499a4 ==============================
[0m17:57:10.486031 [info ] [MainThread]: Running with dbt=1.6.0
[0m17:57:10.486944 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m17:57:10.522103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cb9b4227-ea19-46b5-9a2a-4fdb76b499a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79eb40cbbad0>]}
[0m17:57:10.523157 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m17:57:10.524085 [debug] [MainThread]: Command `dbt deps` succeeded at 17:57:10.523855 after 0.05 seconds
[0m17:57:10.524795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79eb411f1190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79eb44c88590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79eb44de5010>]}
[0m17:57:10.525597 [debug] [MainThread]: Flushing usage events
[0m17:57:10.532440 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m17:57:14.024776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee508e2d850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee508e27150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee508e1e9d0>]}


============================== 17:57:14.029532 | 42022dd0-9a77-451e-9b11-89297bc6456f ==============================
[0m17:57:14.029532 [info ] [MainThread]: Running with dbt=1.6.0
[0m17:57:14.030313 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m17:57:14.118293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '42022dd0-9a77-451e-9b11-89297bc6456f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee508e1f650>]}
[0m17:57:14.129565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '42022dd0-9a77-451e-9b11-89297bc6456f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee508e4c650>]}
[0m17:57:14.130485 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m17:57:14.141623 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m17:57:14.162440 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:57:14.162962 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:57:14.170591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '42022dd0-9a77-451e-9b11-89297bc6456f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee5075a5710>]}
[0m17:57:14.181447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '42022dd0-9a77-451e-9b11-89297bc6456f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee5076e4210>]}
[0m17:57:14.182104 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m17:57:14.182487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '42022dd0-9a77-451e-9b11-89297bc6456f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee50c000450>]}
[0m17:57:14.184186 [info ] [MainThread]: 
[0m17:57:14.185304 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:57:14.187303 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m17:57:14.204577 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m17:57:14.205207 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m17:57:14.205543 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:57:14.215605 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m17:57:14.217997 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m17:57:14.221891 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m17:57:14.232245 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m17:57:14.232799 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m17:57:14.233154 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:57:14.242435 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m17:57:14.243309 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m17:57:14.243789 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m17:57:14.248879 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m17:57:14.251580 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m17:57:14.252498 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m17:57:14.261840 [debug] [MainThread]: Using postgres connection "master"
[0m17:57:14.262457 [debug] [MainThread]: On master: BEGIN
[0m17:57:14.262858 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:57:14.269979 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m17:57:14.270572 [debug] [MainThread]: Using postgres connection "master"
[0m17:57:14.271093 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:57:14.285988 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m17:57:14.289798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '42022dd0-9a77-451e-9b11-89297bc6456f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee509d09a10>]}
[0m17:57:14.291297 [debug] [MainThread]: On master: ROLLBACK
[0m17:57:14.292636 [debug] [MainThread]: Using postgres connection "master"
[0m17:57:14.293512 [debug] [MainThread]: On master: BEGIN
[0m17:57:14.295096 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m17:57:14.295955 [debug] [MainThread]: On master: COMMIT
[0m17:57:14.296426 [debug] [MainThread]: Using postgres connection "master"
[0m17:57:14.296865 [debug] [MainThread]: On master: COMMIT
[0m17:57:14.297397 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m17:57:14.297779 [debug] [MainThread]: On master: Close
[0m17:57:14.298738 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:57:14.299166 [info ] [MainThread]: 
[0m17:57:14.303237 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m17:57:14.304785 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m17:57:14.305702 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m17:57:14.306128 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m17:57:14.315383 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m17:57:14.316394 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 17:57:14.306372 => 17:57:14.316071
[0m17:57:14.316892 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m17:57:14.363410 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m17:57:14.364404 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:57:14.364814 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m17:57:14.365162 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:57:14.373852 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m17:57:14.374963 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:57:14.375983 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m17:57:14.383240 [debug] [Thread-1 (]: SQL status: SELECT 11 in 0.0 seconds
[0m17:57:14.392478 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:57:14.393006 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution" rename to "clean_pollution__dbt_backup"
[0m17:57:14.394183 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:57:14.398345 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:57:14.398847 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m17:57:14.399881 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:57:14.424780 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m17:57:14.425396 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:57:14.425781 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m17:57:14.428002 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m17:57:14.438854 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:57:14.439319 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m17:57:14.442613 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m17:57:14.444676 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 17:57:14.317178 => 17:57:14.444405
[0m17:57:14.445113 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m17:57:14.446159 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42022dd0-9a77-451e-9b11-89297bc6456f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee508e2c190>]}
[0m17:57:14.447032 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 11[0m in 0.14s]
[0m17:57:14.447785 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m17:57:14.451665 [debug] [MainThread]: Using postgres connection "master"
[0m17:57:14.452776 [debug] [MainThread]: On master: BEGIN
[0m17:57:14.453309 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:57:14.459026 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m17:57:14.459432 [debug] [MainThread]: On master: COMMIT
[0m17:57:14.459740 [debug] [MainThread]: Using postgres connection "master"
[0m17:57:14.460012 [debug] [MainThread]: On master: COMMIT
[0m17:57:14.460372 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m17:57:14.460679 [debug] [MainThread]: On master: Close
[0m17:57:14.461360 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:57:14.461679 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m17:57:14.462005 [info ] [MainThread]: 
[0m17:57:14.462326 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.28 seconds (0.28s).
[0m17:57:14.463664 [debug] [MainThread]: Command end result
[0m17:57:14.477415 [info ] [MainThread]: 
[0m17:57:14.478013 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:57:14.478361 [info ] [MainThread]: 
[0m17:57:14.478735 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m17:57:14.479386 [debug] [MainThread]: Command `dbt run` succeeded at 17:57:14.479239 after 0.46 seconds
[0m17:57:14.479836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee509444850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee50ce2c610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee50b033310>]}
[0m17:57:14.480266 [debug] [MainThread]: Flushing usage events
[0m17:57:14.485042 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m17:58:07.448420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fe17409750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fe17408a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fe174090d0>]}


============================== 17:58:07.458110 | ad4c9545-d961-4487-a898-04982c04f33c ==============================
[0m17:58:07.458110 [info ] [MainThread]: Running with dbt=1.6.0
[0m17:58:07.460061 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt deps', 'send_anonymous_usage_stats': 'True'}
[0m17:58:07.536355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ad4c9545-d961-4487-a898-04982c04f33c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fe17242cd0>]}
[0m17:58:07.538722 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m17:58:07.541182 [debug] [MainThread]: Command `dbt deps` succeeded at 17:58:07.540697 after 0.11 seconds
[0m17:58:07.542444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fe1b398490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fe1871e110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fe173f7f50>]}
[0m17:58:07.543925 [debug] [MainThread]: Flushing usage events
[0m17:58:07.556248 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m17:58:11.226853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74da0101c090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74da02955dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74da0100e9d0>]}


============================== 17:58:11.231351 | 93583fd3-7d6b-49ce-b422-d5c9ee3985f1 ==============================
[0m17:58:11.231351 [info ] [MainThread]: Running with dbt=1.6.0
[0m17:58:11.232053 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m17:58:11.319302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '93583fd3-7d6b-49ce-b422-d5c9ee3985f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d9ff8b1390>]}
[0m17:58:11.330527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '93583fd3-7d6b-49ce-b422-d5c9ee3985f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74da0102f310>]}
[0m17:58:11.331386 [info ] [MainThread]: Registered adapter: postgres=1.6.0
[0m17:58:11.342670 [debug] [MainThread]: checksum: 08dabea3fc65f9f8dd48613681c2bcd827397a7ba9ce4c6d52980aba1215e8c9, vars: {}, profile: , target: , version: 1.6.0
[0m17:58:11.365502 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:58:11.366118 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:58:11.374481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '93583fd3-7d6b-49ce-b422-d5c9ee3985f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d9ff769590>]}
[0m17:58:11.386000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '93583fd3-7d6b-49ce-b422-d5c9ee3985f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d9ff8ec1d0>]}
[0m17:58:11.386633 [info ] [MainThread]: Found 1 model, 0 sources, 0 exposures, 0 metrics, 349 macros, 0 groups, 0 semantic models
[0m17:58:11.387021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '93583fd3-7d6b-49ce-b422-d5c9ee3985f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74da0100ed90>]}
[0m17:58:11.388644 [info ] [MainThread]: 
[0m17:58:11.389774 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:58:11.391972 [debug] [ThreadPool]: Acquiring new postgres connection 'list_calidad_aire'
[0m17:58:11.406396 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire"
[0m17:58:11.406950 [debug] [ThreadPool]: On list_calidad_aire: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire"} */

    select distinct nspname from pg_namespace
  
[0m17:58:11.407273 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:58:11.416439 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.0 seconds
[0m17:58:11.418414 [debug] [ThreadPool]: On list_calidad_aire: Close
[0m17:58:11.421381 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_calidad_aire, now list_calidad_aire_public)
[0m17:58:11.430710 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m17:58:11.431229 [debug] [ThreadPool]: On list_calidad_aire_public: BEGIN
[0m17:58:11.431574 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:58:11.438164 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m17:58:11.438845 [debug] [ThreadPool]: Using postgres connection "list_calidad_aire_public"
[0m17:58:11.439318 [debug] [ThreadPool]: On list_calidad_aire_public: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "list_calidad_aire_public"} */
select
      'calidad_aire' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'calidad_aire' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m17:58:11.444470 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m17:58:11.446813 [debug] [ThreadPool]: On list_calidad_aire_public: ROLLBACK
[0m17:58:11.447639 [debug] [ThreadPool]: On list_calidad_aire_public: Close
[0m17:58:11.456298 [debug] [MainThread]: Using postgres connection "master"
[0m17:58:11.457000 [debug] [MainThread]: On master: BEGIN
[0m17:58:11.457413 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:58:11.465904 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m17:58:11.466939 [debug] [MainThread]: Using postgres connection "master"
[0m17:58:11.468008 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:58:11.481914 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m17:58:11.484222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '93583fd3-7d6b-49ce-b422-d5c9ee3985f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74da028b3610>]}
[0m17:58:11.485018 [debug] [MainThread]: On master: ROLLBACK
[0m17:58:11.485779 [debug] [MainThread]: Using postgres connection "master"
[0m17:58:11.486204 [debug] [MainThread]: On master: BEGIN
[0m17:58:11.487217 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m17:58:11.488121 [debug] [MainThread]: On master: COMMIT
[0m17:58:11.488878 [debug] [MainThread]: Using postgres connection "master"
[0m17:58:11.489577 [debug] [MainThread]: On master: COMMIT
[0m17:58:11.490715 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m17:58:11.491500 [debug] [MainThread]: On master: Close
[0m17:58:11.493405 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:58:11.494306 [info ] [MainThread]: 
[0m17:58:11.498857 [debug] [Thread-1 (]: Began running node model.calidad_aire_valencia.clean_pollution
[0m17:58:11.500369 [info ] [Thread-1 (]: 1 of 1 START sql table model public.clean_pollution ............................ [RUN]
[0m17:58:11.502317 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_calidad_aire_public, now model.calidad_aire_valencia.clean_pollution)
[0m17:58:11.503341 [debug] [Thread-1 (]: Began compiling node model.calidad_aire_valencia.clean_pollution
[0m17:58:11.518233 [debug] [Thread-1 (]: Writing injected SQL for node "model.calidad_aire_valencia.clean_pollution"
[0m17:58:11.519494 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (compile): 17:58:11.503701 => 17:58:11.519126
[0m17:58:11.520061 [debug] [Thread-1 (]: Began executing node model.calidad_aire_valencia.clean_pollution
[0m17:58:11.568769 [debug] [Thread-1 (]: Writing runtime sql for node "model.calidad_aire_valencia.clean_pollution"
[0m17:58:11.569774 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:58:11.570168 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: BEGIN
[0m17:58:11.570515 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:58:11.578818 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m17:58:11.579613 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:58:11.580287 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */

  
    

  create  table "calidad_aire"."public"."clean_pollution__dbt_tmp"
  
  
    as
  
  (
    

SELECT
    -- El valor de contaminaciÃ³n
    CAST(data->>'no2' AS NUMERIC) as indice_aqi,
    
    -- El nombre de la estaciÃ³n
    COALESCE(data->>'nombre', 'EstaciÃ³n ' || COALESCE(data->>'objectid', 'X')) as nombre_estacion,
    
    -- EXTRAEMOS LAS COORDENADAS (Â¡La parte nueva!)
    -- La API suele devolver geo_point_2d como un objeto JSON {"lon": X, "lat": Y}
    CAST(data->'geo_point_2d'->>'lat' AS NUMERIC) as latitud,
    CAST(data->'geo_point_2d'->>'lon' AS NUMERIC) as longitud,

    ingestion_time

FROM raw_pollution
WHERE data->>'no2' IS NOT NULL
-- Solo nos quedamos con filas que tengan coordenadas para poder calcular distancias
AND data->'geo_point_2d'->>'lat' IS NOT NULL
  );
  
[0m17:58:11.587766 [debug] [Thread-1 (]: SQL status: SELECT 11 in 0.0 seconds
[0m17:58:11.597829 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:58:11.598338 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution" rename to "clean_pollution__dbt_backup"
[0m17:58:11.599293 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:58:11.603481 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:58:11.603986 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
alter table "calidad_aire"."public"."clean_pollution__dbt_tmp" rename to "clean_pollution"
[0m17:58:11.605084 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m17:58:11.631072 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m17:58:11.631727 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:58:11.632152 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: COMMIT
[0m17:58:11.634201 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m17:58:11.645151 [debug] [Thread-1 (]: Using postgres connection "model.calidad_aire_valencia.clean_pollution"
[0m17:58:11.645638 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: /* {"app": "dbt", "dbt_version": "1.6.0", "profile_name": "calidad_aire_profile", "target_name": "dev", "node_id": "model.calidad_aire_valencia.clean_pollution"} */
drop table if exists "calidad_aire"."public"."clean_pollution__dbt_backup" cascade
[0m17:58:11.648811 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m17:58:11.652049 [debug] [Thread-1 (]: Timing info for model.calidad_aire_valencia.clean_pollution (execute): 17:58:11.520368 => 17:58:11.651654
[0m17:58:11.652728 [debug] [Thread-1 (]: On model.calidad_aire_valencia.clean_pollution: Close
[0m17:58:11.654158 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93583fd3-7d6b-49ce-b422-d5c9ee3985f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d9ff64ba10>]}
[0m17:58:11.655258 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public.clean_pollution ....................... [[32mSELECT 11[0m in 0.15s]
[0m17:58:11.656248 [debug] [Thread-1 (]: Finished running node model.calidad_aire_valencia.clean_pollution
[0m17:58:11.660130 [debug] [MainThread]: Using postgres connection "master"
[0m17:58:11.660617 [debug] [MainThread]: On master: BEGIN
[0m17:58:11.660998 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:58:11.668823 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m17:58:11.669490 [debug] [MainThread]: On master: COMMIT
[0m17:58:11.669943 [debug] [MainThread]: Using postgres connection "master"
[0m17:58:11.670342 [debug] [MainThread]: On master: COMMIT
[0m17:58:11.671143 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m17:58:11.671690 [debug] [MainThread]: On master: Close
[0m17:58:11.672997 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:58:11.673453 [debug] [MainThread]: Connection 'model.calidad_aire_valencia.clean_pollution' was properly closed.
[0m17:58:11.673902 [info ] [MainThread]: 
[0m17:58:11.674324 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.28 seconds (0.28s).
[0m17:58:11.675197 [debug] [MainThread]: Command end result
[0m17:58:11.687542 [info ] [MainThread]: 
[0m17:58:11.688200 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:58:11.688585 [info ] [MainThread]: 
[0m17:58:11.689038 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m17:58:11.689837 [debug] [MainThread]: Command `dbt run` succeeded at 17:58:11.689662 after 0.47 seconds
[0m17:58:11.690349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74da016dd290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74da0501c610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74da0293a210>]}
[0m17:58:11.690876 [debug] [MainThread]: Flushing usage events
[0m17:58:11.698006 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
